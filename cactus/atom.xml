<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>糖小米 · 博客</title>
  
  <subtitle>厚积薄发</subtitle>
  <link href="https://tangxiaomi.top/atom.xml" rel="self"/>
  
  <link href="https://tangxiaomi.top/"/>
  <updated>2021-05-28T01:23:48.106Z</updated>
  <id>https://tangxiaomi.top/</id>
  
  <author>
    <name>糖小米</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>3.用递归算法实现，数组长度为5且元素的随机数在2-32间不重复的值</title>
    <link href="https://tangxiaomi.top/2021/05/28/interview/3.%E7%94%A8%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6%E4%B8%BA5%E4%B8%94%E5%85%83%E7%B4%A0%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%9C%A82-32%E9%97%B4%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%80%BC/"/>
    <id>https://tangxiaomi.top/2021/05/28/interview/3.%E7%94%A8%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6%E4%B8%BA5%E4%B8%94%E5%85%83%E7%B4%A0%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%9C%A82-32%E9%97%B4%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%80%BC/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>这是一道大题目，把考点拆成了4个小项；需要侯选人用递归算法实现（限制15行代码以内实现；限制时间10分钟内完成）： </p><ul><li>生成一个长度为5的空数组 <code>arr</code> 。 </li><li>生成一个（2－32）之间的随机整数 <code>rand</code>。</li><li>把随机数 <code>rand</code> 插入到数组 <code>arr</code> 内，如果数组arr内已存在与 <code>rand</code> 相同的数字，则重新生成随机数<code>rand</code>并插入到<code>arr</code>内[需要使用递归实现，不能使用 <code>for/while</code> 等循环] </li><li>最终输出一个长度为5，且内容不重复的数组 <code>arr</code> 。</li></ul><h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> randomNum = <span class="function">() =&gt;</span> (<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">31</span> + <span class="number">2</span>))</span><br><span class="line"><span class="keyword">const</span> randomArr = <span class="function">(<span class="params">n</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">0</span>) <span class="keyword">return</span> arr;</span><br><span class="line">    <span class="keyword">const</span> num = randomNum();</span><br><span class="line">    <span class="keyword">if</span> (arr.includes(num)) <span class="keyword">return</span> randomArr(n)</span><br><span class="line">    arr[n -<span class="number">1</span>] = num;</span><br><span class="line">    <span class="keyword">return</span> randomArr(n - <span class="number">1</span>)</span><br><span class="line">&#125;;</span><br><span class="line">randomArr(arr.length)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>#interview/javascript</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;这是一道大题目，把考点拆成了4个小项；需要侯选人用递归算法实现（限制15行代码以内实现；限制时间10分钟内完成）： &lt;/p&gt;
&lt;ul&gt;
&lt;l</summary>
      
    
    
    
    <category term="interview" scheme="https://tangxiaomi.top/categories/interview/"/>
    
    
    <category term="interview" scheme="https://tangxiaomi.top/tags/interview/"/>
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>4.html的元素有哪些（包含H5）？</title>
    <link href="https://tangxiaomi.top/2021/05/28/interview/4.html%E7%9A%84%E5%85%83%E7%B4%A0%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%88%E5%8C%85%E5%90%ABH5%EF%BC%89%EF%BC%9F/"/>
    <id>https://tangxiaomi.top/2021/05/28/interview/4.html%E7%9A%84%E5%85%83%E7%B4%A0%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%88%E5%8C%85%E5%90%ABH5%EF%BC%89%EF%BC%9F/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>区分出行内元素、块级元素、空元素并在后面简要标注下作用</p><a id="more"></a><h2 id="行内元素"><a href="#行内元素" class="headerlink" title="行内元素"></a>行内元素</h2><ul><li>a</li><li>b</li><li>span</li><li>strong</li><li>i</li><li>em</li><li>button</li><li>input</li><li>label</li><li>br</li><li>textarea</li><li>select</li></ul><h2 id="块元素"><a href="#块元素" class="headerlink" title="块元素"></a>块元素</h2><ul><li>div</li><li>p</li><li>h1-h6</li><li>ol</li><li>ul</li><li>li</li><li>table</li><li>tbody</li><li>td</li><li>tr</li><li>thead</li><li>dl</li><li>dt</li><li>dd</li></ul><h2 id="H5新增元素"><a href="#H5新增元素" class="headerlink" title="H5新增元素"></a>H5新增元素</h2><ul><li><code>section</code>  标签定义文档中的节</li><li><code>article </code> 标签的内容独立于文档的其余部分</li><li><code>audio</code> 标签定义声音，比如音乐或其他音频流</li><li><code>video</code> 标签定义视频，比如电影片段或其他视频流</li><li><code>hearder</code> 标签定义文档的页眉（介绍信息）</li><li><code>footer</code> 标签定义文档或节的页脚</li><li><code>small</code> 标签呈现小号字体效果</li><li><code>canvas</code> 定义画布</li></ul><p>#interview/html</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;区分出行内元素、块级元素、空元素并在后面简要标注下作用&lt;/p&gt;</summary>
    
    
    
    <category term="interview" scheme="https://tangxiaomi.top/categories/interview/"/>
    
    
    <category term="interview" scheme="https://tangxiaomi.top/tags/interview/"/>
    
    <category term="html" scheme="https://tangxiaomi.top/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>6.写一个方法去掉字符串中的空格</title>
    <link href="https://tangxiaomi.top/2021/05/28/interview/6.%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E5%8E%BB%E6%8E%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%A9%BA%E6%A0%BC/"/>
    <id>https://tangxiaomi.top/2021/05/28/interview/6.%E5%86%99%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E5%8E%BB%E6%8E%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%A9%BA%E6%A0%BC/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>写一个方法去掉字符串中的空格，要求传入不同的类型分别能去掉前、后、前后、中间的空格 </p><a id="more"></a><h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;  s t  r  &quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> POSITION = <span class="built_in">Object</span>.freeze(&#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="built_in">Symbol</span>(),</span><br><span class="line">    <span class="attr">right</span>: <span class="built_in">Symbol</span>(),</span><br><span class="line">    <span class="attr">both</span>: <span class="built_in">Symbol</span>(),</span><br><span class="line">    <span class="attr">center</span>: <span class="built_in">Symbol</span>(),</span><br><span class="line">    <span class="attr">all</span>: <span class="built_in">Symbol</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">str, position = POSITION.both</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!!POSITION[position]) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;unexpected position value&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (position) &#123;</span><br><span class="line">        <span class="keyword">case</span> POSITION.left:</span><br><span class="line">            str = str.replace(<span class="regexp">/^\s+/</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> POSITION.right:</span><br><span class="line">            str = str.replace(<span class="regexp">/\s+$/</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> POSITION.both:</span><br><span class="line">            str = str.replace(<span class="regexp">/^\s+/</span>, <span class="string">&quot;&quot;</span>).replace(<span class="regexp">/\s+$/</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> POSITION.center:</span><br><span class="line">            <span class="keyword">while</span> (str.match(<span class="regexp">/\w\s+\w/</span>)) &#123;</span><br><span class="line">                str = str.replace(<span class="regexp">/(\w)(\s+)(\w)/</span>, <span class="string">`$1$3`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> POSITION.all:</span><br><span class="line">            str = str.replace(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = trim(str);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`|<span class="subst">$&#123;result&#125;</span>|`</span>); <span class="comment">//  |s t  r|</span></span><br></pre></td></tr></table></figure><p>#interview/javascript</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;写一个方法去掉字符串中的空格，要求传入不同的类型分别能去掉前、后、前后、中间的空格 &lt;/p&gt;</summary>
    
    
    
    <category term="interview" scheme="https://tangxiaomi.top/categories/interview/"/>
    
    
    <category term="interview" scheme="https://tangxiaomi.top/tags/interview/"/>
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>7.HTML全局属性(globalattribute)有哪些（包含H5）？</title>
    <link href="https://tangxiaomi.top/2021/05/28/interview/7.HTML%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7(globalattribute)%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%88%E5%8C%85%E5%90%ABH5%EF%BC%89%EF%BC%9F/"/>
    <id>https://tangxiaomi.top/2021/05/28/interview/7.HTML%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7(globalattribute)%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%88%E5%8C%85%E5%90%ABH5%EF%BC%89%EF%BC%9F/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p><code>accesskey</code>   设置快捷键<br><code>class</code>  为元素设置类标识<br><code>contenteditable</code>  指定元素内容是否可编辑<br><code>contextmenu</code>  自定义鼠标右键弹出上下文菜单内容（仅firefox支持）<br><code>data-*</code>  为元素增加自定义属性<br>dir：设置元素文本方向（默认ltr；rtl）<br><code>draggable</code>  设置元素是否可拖拽<br><code>dropzone</code>  设置元素拖放类型（copy|move|link,H5新属性，主流均不支持）<br><code>hidden</code>  规定元素仍未或不在相关<br><code>id</code>  元素id，文档内唯一<br><code>lang</code>  元素内容的语言<br><code>spellcheck</code>  是否启动拼写和语法检查<br><code>style</code>  行内css样式<br><code>tabindex</code>  设置元素可以获得焦点，通过tab导航<br><code>title</code>  规定元素有关的额外信息</p><blockquote><p>相关链接：<a href="~https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes~">Global attributes</a>  </p></blockquote><p>#interview/html</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;accesskey&lt;/code&gt;   设置快捷键&lt;br&gt;&lt;code&gt;class&lt;/code&gt;  为元素设置类标识&lt;br&gt;&lt;code&gt;contenteditable&lt;/code&gt;  指定元素内容是否可编辑&lt;br&gt;&lt;code&gt;contextmenu&lt;/code&gt;  </summary>
      
    
    
    
    <category term="interview" scheme="https://tangxiaomi.top/categories/interview/"/>
    
    
    <category term="interview" scheme="https://tangxiaomi.top/tags/interview/"/>
    
    <category term="html" scheme="https://tangxiaomi.top/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>8.在页面上隐藏元素的方法有哪些？</title>
    <link href="https://tangxiaomi.top/2021/05/28/interview/8.%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/"/>
    <id>https://tangxiaomi.top/2021/05/28/interview/8.%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>在页面上隐藏元素的方法有哪些？ 并简述出第一种方法的应用场景和优劣势</p><a id="more"></a><h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><ul><li>占位:</li></ul><p><code>visibility: hidden;</code>  看不见但是会占据空间<br><code>margin-left: -100%;</code><br><code>opacity: 0;</code> 看不见但是会占据空间<br><code>transform: scale(0);</code><br><code>filter: opacity(0);</code></p><ul><li>不占位:</li></ul><p><code>display: none;</code>  页面不会渲染<br><code>width: 0;</code><br><code>height: 0;</code><br><code>overflow: hidden;</code> 页面会渲染但是不显示<br><code>position</code> 配合 <code>z-index</code>; 或者 <code>left/top/bottom/right ： -100%；</code><br><code>transform: scale(0);</code><br><code>translateX(+-100%);</code><br><code>translateY(+-100%);</code><br><code>rotateX(90deg);</code></p><ul><li>仅对块内文本元素:</li></ul><p><code>text-indent: -9999px;</code><br><code>font-size: 0;</code></p><p>#interview/css</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;在页面上隐藏元素的方法有哪些？ 并简述出第一种方法的应用场景和优劣势&lt;/p&gt;</summary>
    
    
    
    <category term="interview" scheme="https://tangxiaomi.top/categories/interview/"/>
    
    
    <category term="css" scheme="https://tangxiaomi.top/tags/css/"/>
    
    <category term="interview" scheme="https://tangxiaomi.top/tags/interview/"/>
    
  </entry>
  
  <entry>
    <title>HTML5Canvas生成粒子效果</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/HTML5Canvas%E7%94%9F%E6%88%90%E7%B2%92%E5%AD%90%E6%95%88%E6%9E%9C/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/HTML5Canvas%E7%94%9F%E6%88%90%E7%B2%92%E5%AD%90%E6%95%88%E6%9E%9C/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p><a href="~https://cdn.jsdelivr.net/gh/im/oss@master/js/breathing-halftone.pkgd.min.js~">breathing-halftone.pkgd.min.js</a></p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the image</span></span><br><span class="line"><span class="comment">// jquery</span></span><br><span class="line"><span class="keyword">var</span> img = $(<span class="string">&#x27;#hero img&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment">// or vanilla JS</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#hero img&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// init halftone</span></span><br><span class="line"><span class="keyword">new</span> BreathingHalftone(img, &#123;</span><br><span class="line">    <span class="comment">// options...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;dotSize&quot;</span>: <span class="number">1</span> / <span class="number">150</span>,</span><br><span class="line">    <span class="comment">//点的大小</span></span><br><span class="line">    <span class="comment">//作为图像对角线的一小部分</span></span><br><span class="line">    <span class="comment">//较小的点=较多的点=性能较差</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;dotSizeThreshold&quot;</span>: <span class="number">0.05</span>,</span><br><span class="line">    <span class="comment">//隐藏小于百分比的点</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;initVelocity&quot;</span>: <span class="number">0.1</span>,</span><br><span class="line">    <span class="comment">//点开始增长的速度</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;oscPeriod&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="comment">//点大小振荡或“呼吸”周期的持续时间（以秒为单位）</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;oscAmplitude&quot;</span>: <span class="number">0.2</span>,</span><br><span class="line">    <span class="comment">//振荡变化百分比</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;isAdditive&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//添加剂是带有RGB点的黑色，</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//减法为带有CMK点的白色</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;isRadial&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//启用径向网格布局</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;channels&quot;</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>],</span><br><span class="line">    <span class="comment">//点层</span></span><br><span class="line">    <span class="comment">//&#x27;lum&#x27;是另一个受支持的通道，以实现亮度</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;isChannelLens&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//禁用位移时更改点的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;friction&quot;</span>: <span class="number">0.06</span>,</span><br><span class="line">    <span class="comment">//较低的点使点更容易移动，较高的点使点更难</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;hoverDiameter&quot;</span>: <span class="number">0.2</span>,</span><br><span class="line">    <span class="comment">//悬停效果的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//作为图像对角线的一小部分</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;hoverForce&quot;</span>: <span class="number">0.01</span>,</span><br><span class="line">    <span class="comment">//悬停效果的力量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//负值会拉入点，正值会拉出</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;activeDiameter&quot;</span>: <span class="number">0.6</span>,</span><br><span class="line">    <span class="comment">//点击/点击效果的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//作为图像对角线的一小部分</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;activeForce&quot;</span>: <span class="number">0.01</span></span><br><span class="line">    <span class="comment">//悬停效果的力量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//负值会拉入点，正值会拉出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Dome"><a href="#Dome" class="headerlink" title="Dome"></a>Dome</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/im/oss@master/js/breathing-halftone.pkgd.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">height</span>=<span class="string">&quot;400&quot;</span> <span class="attr">id</span>=<span class="string">&quot;html5-canvas-particle-effect-dome&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/images/header/avatar.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> img = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;html5-canvas-particle-effect-dome&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> BreathingHalftone(img, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;dotSize&quot;</span>: <span class="number">1</span> / <span class="number">150</span></span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Quote"><a href="#Quote" class="headerlink" title="Quote"></a>Quote</h2><blockquote><p><a href="~http://breathing-halftone.desandro.com/~">http://breathing-halftone.desandro.com/</a>  </p></blockquote><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Install&quot;&gt;&lt;a href=&quot;#Install&quot; class=&quot;headerlink&quot; title=&quot;Install&quot;&gt;&lt;/a&gt;Install&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;~https://cdn.jsdelivr.net/gh/im/oss@master/js/breathing-halftone.pkgd.min.js~&quot;&gt;breathing-halftone.pkgd.min.js&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Usage&quot;&gt;&lt;a href=&quot;#Usage&quot; class=&quot;headerlink&quot; title=&quot;Usage&quot;&gt;&lt;/a&gt;Usage&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// get the image&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// jquery&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; img = $(&lt;span class=&quot;string&quot;&gt;&amp;#x27;#hero img&amp;#x27;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// or vanilla JS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; img = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.querySelector(&lt;span class=&quot;string&quot;&gt;&amp;#x27;#hero img&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// init halftone&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BreathingHalftone(img, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// options...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript内存泄漏教程</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%95%99%E7%A8%8B/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%95%99%E7%A8%8B/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>程序的运行需要内存。只要程序提出要求，操作系统或者运行时（runtime）就必须供给内存。</p><p>对于持续运行的服务进程（daemon），必须及时释放不再用到的内存。否则，内存占用越来越高，轻则影响系统性能，重则导致进程崩溃。</p><p><img src="/images/bg2017041701-1.png"><br>不再用到的内存，没有及时释放，就叫做内存泄漏（memory leak）。</p><p>有些语言（比如 C 语言）必须手动释放内存，程序员负责内存管理。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> * buffer;</span><br><span class="line">buffer = (<span class="keyword">char</span>*) <span class="built_in">malloc</span>(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do something with buffer</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(buffer);</span><br></pre></td></tr></table></figure><p>上面是 C 语言代码， <code>malloc</code> 方法用来申请内存，使用完毕之后，必须自己用 <code>free</code> 方法释放内存。</p><p>这很麻烦，所以大多数语言提供自动内存管理，减轻程序员的负担，这被称为”垃圾回收机制”（<strong>garbage collector</strong>）。</p><a id="more"></a><h2 id="二、垃圾回收机制"><a href="#二、垃圾回收机制" class="headerlink" title="二、垃圾回收机制"></a>二、垃圾回收机制</h2><p>垃圾回收机制怎么知道，哪些内存不再需要呢？</p><p>最常使用的方法叫做 <a href="https://en.wikipedia.org/wiki/Reference_counting">“引用计数”</a> （reference counting）：语言引擎有一张”引用表”，保存了内存里面所有的资源（通常是各种值）的引用次数。如果一个值的引用次数是 <code>0</code> ，就表示这个值不再用到了，因此可以将这块内存释放。</p><p><img src="/images/bg2017041703.png"></p><p>上图中，左下角的两个值，没有任何引用，所以可以释放。</p><p>如果一个值不再需要了，引用数却不为 <code>0</code> ，垃圾回收机制无法释放这块内存，从而导致内存泄漏。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>);</span><br></pre></td></tr></table></figure><p>上面代码中，数组 <code>[1, 2, 3, 4]</code> 是一个值，会占用内存。变量 <code>arr</code> 是仅有的对这个值的引用，因此引用次数为 <code>1</code> 。尽管后面的代码没有用到 <code>arr</code> ，它还是会持续占用内存。</p><p>如果增加一行代码，解除 <code>arr</code> 对 <code>[1, 2, 3, 4]</code> 引用，这块内存就可以被垃圾回收机制释放了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">arr = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>上面代码中， <code>arr</code> 重置为 <code>null</code> ，就解除了对 <code>[1, 2, 3, 4]</code> 的引用，引用次数变成了 <code>0</code> ，内存就可以释放出来了。</p><p>因此，并不是说有了垃圾回收机制，程序员就轻松了。你还是需要关注内存占用：那些很占空间的值，一旦不再用到，你必须检查是否还存在对它们的引用。如果是的话，就必须手动解除引用。</p><h2 id="三、内存泄漏的识别方法"><a href="#三、内存泄漏的识别方法" class="headerlink" title="三、内存泄漏的识别方法"></a>三、内存泄漏的识别方法</h2><p>怎样可以观察到内存泄漏呢？</p><p><a href="https://www.toptal.com/nodejs/debugging-memory-leaks-node-js-applications">经验法则</a> 是，如果连续五次垃圾回收之后，内存占用一次比一次大，就有内存泄漏。这就要求实时查看内存占用。</p><h3 id="3-1-浏览器"><a href="#3-1-浏览器" class="headerlink" title="3.1 浏览器"></a>3.1 浏览器</h3><p>Chrome 浏览器查看内存占用，按照以下步骤操作。</p><p><img src="/images/bg2017041704.png"></p><ol><li>打开开发者工具，选择 Timeline 面板</li><li>在顶部的 <code>Capture</code> 字段里面勾选 Memory</li><li>点击左上角的录制按钮。</li><li>在页面上进行各种操作，模拟用户的使用情况。</li><li>一段时间后，点击对话框的 stop 按钮，面板上就会显示这段时间的内存占用情况。</li></ol><p>如果内存占用基本平稳，接近水平，就说明不存在内存泄漏。</p><p><img src="/images/bg2017041705.png"></p><p>反之，就是内存泄漏了。</p><p><img src="/images/bg2017041706.png"></p><h3 id="3-2-命令行"><a href="#3-2-命令行" class="headerlink" title="3.2 命令行"></a>3.2 命令行</h3><p>命令行可以使用 Node 提供的 <a href="https://nodejs.org/api/process.html#process_process_memoryusage">process.memoryUsage</a> 方法。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(process.memoryUsage());</span><br><span class="line">// &#123; rss: 27709440,</span><br><span class="line">//  heapTotal: 5685248,</span><br><span class="line">//  heapUsed: 3449392,</span><br><span class="line">//  external: 8772 &#125;</span><br></pre></td></tr></table></figure><p><code>process.memoryUsage</code> 返回一个对象，包含了 Node 进程的内存占用信息。该对象包含四个字段，单位是字节， <a href="http://stackoverflow.com/questions/12023359/what-do-the-return-values-of-node-js-process-memoryusage-stand-for">含义</a> 如下。</p><p><img src="/images/bg2017041702-1.png"></p><ul><li>rss（resident set size）：所有内存占用，包括指令区和堆栈。</li><li>heapTotal：”堆”占用的内存，包括用到的和没用到的。</li><li>heapUsed：用到的堆的部分。</li><li>external： V8 引擎内部的 C++ 对象占用的内存。</li></ul><p>判断内存泄漏，以 <code>heapUsed</code> 字段为准。</p><h2 id="四、WeakMap"><a href="#四、WeakMap" class="headerlink" title="四、WeakMap"></a>四、WeakMap</h2><p>前面说过，及时清除引用非常重要。但是，你不可能记得那么多，有时候一疏忽就忘了，所以才有那么多内存泄漏。</p><p>最好能有一种方法，在新建引用的时候就声明，哪些引用必须手动清除，哪些引用可以忽略不计，当其他引用消失以后，垃圾回收机制就可以释放内存。这样就能大大减轻程序员的负担，你只要清除主要引用就可以了。</p><p>ES6 考虑到了这一点，推出了两种新的数据结构： <a href="http://es6.ruanyifeng.com/#docs/set-map#WeakSet">WeakSet</a> 和 <a href="http://es6.ruanyifeng.com/#docs/set-map#WeakMap">WeakMap</a> 。它们对于值的引用都是不计入垃圾回收机制的，所以名字里面才会有一个”Weak”，表示这是弱引用。</p><p><img src="/images/bg2017041707.jpg"></p><p>下面以 WeakMap 为例，看看它是怎么解决内存泄漏的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;example&#x27;</span>);</span><br><span class="line"></span><br><span class="line">wm.set(element, <span class="string">&#x27;some information&#x27;</span>);</span><br><span class="line">wm.get(element) <span class="comment">// &quot;some information&quot;</span></span><br></pre></td></tr></table></figure><p>上面代码中，先新建一个 Weakmap 实例。然后，将一个 DOM 节点作为键名存入该实例，并将一些附加信息作为键值，一起存放在 WeakMap 里面。这时，WeakMap 里面对 <code>element</code> 的引用就是弱引用，不会被计入垃圾回收机制。</p><p>也就是说，DOM 节点对象的引用计数是 <code>1</code> ，而不是 <code>2</code> 。这时，一旦消除对该节点的引用，它占用的内存就会被垃圾回收机制释放。Weakmap 保存的这个键值对，也会自动消失。</p><p>基本上，如果你要往对象上添加数据，又不想干扰垃圾回收机制，就可以使用 WeakMap。</p><h2 id="五、WeakMap-示例"><a href="#五、WeakMap-示例" class="headerlink" title="五、WeakMap 示例"></a>五、WeakMap 示例</h2><p>WeakMap 的例子很难演示，因为无法观察它里面的引用会自动消失。此时，其他引用都解除了，已经没有引用指向 WeakMap 的键名了，导致无法证实那个键名是不是存在。</p><p>我一直想不出办法，直到有一天贺师俊老师 <a href="https://github.com/ruanyf/es6tutorial/issues/362#issuecomment-292109104">提示</a> ，如果引用所指向的值占用特别多的内存，就可以通过 <code>process.memoryUsage</code> 方法看出来。</p><p>根据这个思路，网友 vtxf 补充了下面的 <a href="https://github.com/ruanyf/es6tutorial/issues/362#issuecomment-292451925">例子</a> 。</p><p>首先，打开 Node 命令行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node --expose-gc</span></span><br></pre></td></tr></table></figure><p>上面代码中， <code>--expose-gc</code> 参数表示允许手动执行垃圾回收机制。</p><p>然后，执行下面的代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动执行一次垃圾回收，保证获取的内存使用状态准确</span></span><br><span class="line">&gt; <span class="built_in">global</span>.gc(); </span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看内存占用的初始状态，heapUsed 为 4M 左右</span></span><br><span class="line">&gt; process.memoryUsage(); </span><br><span class="line">&#123; <span class="attr">rss</span>: <span class="number">21106688</span>,</span><br><span class="line">  <span class="attr">heapTotal</span>: <span class="number">7376896</span>,</span><br><span class="line">  <span class="attr">heapUsed</span>: <span class="number">4153936</span>,</span><br><span class="line">  <span class="attr">external</span>: <span class="number">9059</span> &#125;</span><br><span class="line"></span><br><span class="line">&gt; <span class="keyword">let</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">global</span>.gc();</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时，heapUsed 仍然为 4M 左右</span></span><br><span class="line">&gt; process.memoryUsage(); </span><br><span class="line">&#123; <span class="attr">rss</span>: <span class="number">20537344</span>,</span><br><span class="line">  <span class="attr">heapTotal</span>: <span class="number">9474048</span>,</span><br><span class="line">  <span class="attr">heapUsed</span>: <span class="number">3967272</span>,</span><br><span class="line">  <span class="attr">external</span>: <span class="number">8993</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 WeakMap 中添加一个键值对，</span></span><br><span class="line"><span class="comment">// 键名为对象 b，键值为一个 5*1024*1024 的数组  </span></span><br><span class="line">&gt; wm.set(b, <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">5</span>*<span class="number">1024</span>*<span class="number">1024</span>));</span><br><span class="line"><span class="built_in">WeakMap</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动执行一次垃圾回收</span></span><br><span class="line">&gt; <span class="built_in">global</span>.gc();</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时，heapUsed 为 45M 左右</span></span><br><span class="line">&gt; process.memoryUsage(); </span><br><span class="line">&#123; <span class="attr">rss</span>: <span class="number">62652416</span>,</span><br><span class="line">  <span class="attr">heapTotal</span>: <span class="number">51437568</span>,</span><br><span class="line">  <span class="attr">heapUsed</span>: <span class="number">45911664</span>,</span><br><span class="line">  <span class="attr">external</span>: <span class="number">8951</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除对象 b 的引用  </span></span><br><span class="line">&gt; b = <span class="literal">null</span>;</span><br><span class="line"><span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 再次执行垃圾回收</span></span><br><span class="line">&gt; <span class="built_in">global</span>.gc();</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除 b 的引用以后，heapUsed 变回 4M 左右</span></span><br><span class="line"><span class="comment">// 说明 WeakMap 中的那个长度为 5*1024*1024 的数组被销毁了</span></span><br><span class="line">&gt; process.memoryUsage(); </span><br><span class="line">&#123; <span class="attr">rss</span>: <span class="number">20639744</span>,</span><br><span class="line">  <span class="attr">heapTotal</span>: <span class="number">8425472</span>,</span><br><span class="line">  <span class="attr">heapUsed</span>: <span class="number">3979792</span>,</span><br><span class="line">  <span class="attr">external</span>: <span class="number">8956</span> &#125;</span><br></pre></td></tr></table></figure><p>上面代码中，只要外部的引用消失，WeakMap 内部的引用，就会自动被垃圾回收清除。由此可见，有了它的帮助，解决内存泄漏就会简单很多。</p><p><a href="http://www.ruanyifeng.com/blog/2017/04/memory-leak.html">JavaScript 内存泄漏教程</a></p><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;程序的运行需要内存。只要程序提出要求，操作系统或者运行时（runtime）就必须供给内存。&lt;/p&gt;
&lt;p&gt;对于持续运行的服务进程（daemon），必须及时释放不再用到的内存。否则，内存占用越来越高，轻则影响系统性能，重则导致进程崩溃。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/bg2017041701-1.png&quot;&gt;&lt;br&gt;不再用到的内存，没有及时释放，就叫做内存泄漏（memory leak）。&lt;/p&gt;
&lt;p&gt;有些语言（比如 C 语言）必须手动释放内存，程序员负责内存管理。&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * buffer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;buffer = (&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;*) &lt;span class=&quot;built_in&quot;&gt;malloc&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;42&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Do something with buffer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;free&lt;/span&gt;(buffer);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;上面是 C 语言代码， &lt;code&gt;malloc&lt;/code&gt; 方法用来申请内存，使用完毕之后，必须自己用 &lt;code&gt;free&lt;/code&gt; 方法释放内存。&lt;/p&gt;
&lt;p&gt;这很麻烦，所以大多数语言提供自动内存管理，减轻程序员的负担，这被称为”垃圾回收机制”（&lt;strong&gt;garbage collector&lt;/strong&gt;）。&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript实现前端下载图片</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><ul><li>  将图片装换成 Data URLs</li><li>  下载图片</li></ul><h4 id="Data-URLs"><a href="#Data-URLs" class="headerlink" title="Data URLs"></a>Data URLs</h4><blockquote><p>Data URLs，即前缀为 data: 协议的的 URL，其允许内容创建者向文档中嵌入小文件。<br>Data URLs 由四个部分组成：前缀(data:)、指示数据类型的 MIME 类型、如果非文本则为可选的 base64 标记、数据本身：<br>data:[<mediatype>][;base64],<data><br>mediative 是个 MIME 类型的字符串，例如 “image/jpeg” 表示 JPEG 图像文件。如果被省略，则默认值为 text/plain;charset=US-ASCII<br>如果数据是文本类型，你可以直接将文本嵌入 (根据文档类型，使用合适的实体字符或转义字符)。如果是二进制数据，你可以将数据进行 base64 编码之后再进行嵌入。  </p></blockquote><p>详细请看 MDN 对 <a href="~https://developer.mozilla.org/zh-CN/docs/Web/HTTP/data_URIs~">Data URLs</a> 的解释。</p><a id="more"></a><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>以下是获取图片 DataURL 的示例代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取图片的 base64 编码 DataURL</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param </span>image JS 图像对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>已编码的 DataURL</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="title">getImageDataURL</span>(<span class="params">image</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 创建画布</span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">    canvas.width = image.width;</span><br><span class="line">    canvas.height = image.height;</span><br><span class="line">    <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">    <span class="comment">// 以图片为背景剪裁画布</span></span><br><span class="line">    ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, image.width, image.height);</span><br><span class="line">    <span class="comment">// 获取图片后缀名</span></span><br><span class="line">    <span class="keyword">const</span> extension = image.src.substring(image.src.lastIndexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>).toLowerCase();</span><br><span class="line">    <span class="comment">// 某些图片 url 可能没有后缀名，默认是 png</span></span><br><span class="line">    <span class="keyword">return</span> canvas.toDataURL(<span class="string">&#x27;image/&#x27;</span> + extension, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行上面的函数后会返回如下面的格式一样的字符串</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAgAElEQVR4Xu1dB3hUxfb/bc3uppOeQOgIAioKCiqWJ/bysFd89vcXe0WfvSJ2wY6gPhX1WZ...</span><br></pre></td></tr></table></figure><p>注意：图片越大，转换后的 base64 编码越长，尽量避免对大图进行 DataURL 转换，防止转换后的长度超出浏览器限制</p><p>以下是下载图片的示例代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">downLoad</span>(<span class="params">downloadName, url</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tag = <span class="built_in">document</span>.createElement(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="comment">// 此属性的值就是下载时图片的名称，注意，名称中不能有半角点，否则下载时后缀名会错误</span></span><br><span class="line">    tag.setAttribute(<span class="string">&#x27;download&#x27;</span>, downloadName.replace(<span class="regexp">/\./g</span>, <span class="string">&#x27;。&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">    <span class="comment">// 设置 image 的 url, 添加时间戳，防止浏览器缓存图片</span></span><br><span class="line">    image.src = url + <span class="string">&#x27;?time=&#x27;</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="comment">//重要，设置 crossOrigin 属性，否则图片跨域会报错</span></span><br><span class="line">    image.setAttribute(<span class="string">&#x27;crossOrigin&#x27;</span>, <span class="string">&#x27;Anonymous&#x27;</span>);</span><br><span class="line">    <span class="comment">// 图片未加载完成时操作会报错</span></span><br><span class="line">    image.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        tag.href = getImageDataURL(image);</span><br><span class="line">        tag.click();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;实现思路&quot;&gt;&lt;a href=&quot;#实现思路&quot; class=&quot;headerlink&quot; title=&quot;实现思路&quot;&gt;&lt;/a&gt;实现思路&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;  将图片装换成 Data URLs&lt;/li&gt;
&lt;li&gt;  下载图片&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;Data-URLs&quot;&gt;&lt;a href=&quot;#Data-URLs&quot; class=&quot;headerlink&quot; title=&quot;Data URLs&quot;&gt;&lt;/a&gt;Data URLs&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;Data URLs，即前缀为 data: 协议的的 URL，其允许内容创建者向文档中嵌入小文件。&lt;br&gt;Data URLs 由四个部分组成：前缀(data:)、指示数据类型的 MIME 类型、如果非文本则为可选的 base64 标记、数据本身：&lt;br&gt;data:[&lt;mediatype&gt;][;base64],&lt;data&gt;&lt;br&gt;mediative 是个 MIME 类型的字符串，例如 “image/jpeg” 表示 JPEG 图像文件。如果被省略，则默认值为 text/plain;charset=US-ASCII&lt;br&gt;如果数据是文本类型，你可以直接将文本嵌入 (根据文档类型，使用合适的实体字符或转义字符)。如果是二进制数据，你可以将数据进行 base64 编码之后再进行嵌入。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;详细请看 MDN 对 &lt;a href=&quot;~https://developer.mozilla.org/zh-CN/docs/Web/HTTP/data_URIs~&quot;&gt;Data URLs&lt;/a&gt; 的解释。&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript实现复制粘贴</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%AE%9E%E7%8E%B0%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E5%AE%9E%E7%8E%B0%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><h2 id="html"><a href="#html" class="headerlink" title="html:"></a>html:</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;copyToClip(&#x27;内容&#x27;)&quot;</span>&gt;</span>Copy<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="javascript"><a href="#javascript" class="headerlink" title="javascript:"></a>javascript:</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 复制内容到粘贴板</span></span><br><span class="line"><span class="comment"> * content : 需要复制的内容</span></span><br><span class="line"><span class="comment"> * message : 复制完后的提示，不传则默认提示&quot;复制成功&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyToClip</span>(<span class="params">content, message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> aux = <span class="built_in">document</span>.createElement(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">    aux.setAttribute(<span class="string">&#x27;value&#x27;</span>, content)</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(aux)</span><br><span class="line">    aux.select()</span><br><span class="line">    <span class="built_in">document</span>.execCommand(<span class="string">&#x27;copy&#x27;</span>)</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(aux)</span><br><span class="line">    <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">        alert(<span class="string">&#x27;复制成功&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(mesage)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="clipboard-js-https-clipboardjs-com"><a href="#clipboard-js-https-clipboardjs-com" class="headerlink" title="(clipboard.js)[https://clipboardjs.com/]"></a>(clipboard.js)[<a href="https://clipboardjs.com/]">https://clipboardjs.com/]</a></h2><p>直接引用： <code>&lt;script src=&quot;dist/clipboard.min.js&quot;&gt;&lt;/script&gt;</code></p><p>包： <code>npm install clipboard --save </code>，然后 <code>import Clipboard from &#39;clipboard&#39;</code></p><h2 id="html-1"><a href="#html-1" class="headerlink" title="html:"></a>html:</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;demoInput&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hello world&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">data-clipboard-target</span>=<span class="string">&quot;#demoInput&quot;</span>&gt;</span>点我复制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="javascript-1"><a href="#javascript-1" class="headerlink" title="javascript:"></a>javascript:</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Clipboard <span class="keyword">from</span> <span class="string">&#x27;clipboard&#x27;</span></span><br><span class="line"><span class="keyword">const</span> btnCopy = <span class="keyword">new</span> Clipboard(<span class="string">&#x27;btn&#x27;</span>)</span><br></pre></td></tr></table></figure><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;实现思路&quot;&gt;&lt;a href=&quot;#实现思路&quot; class=&quot;headerlink&quot; title=&quot;实现思路&quot;&gt;&lt;/a&gt;实现思路&lt;/h2&gt;&lt;h2 id=&quot;html&quot;&gt;&lt;a href=&quot;#html&quot; class=&quot;headerlink&quot; title=&quot;html:&quot;&gt;&lt;/a&gt;html:&lt;/h2&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;onclick&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;copyToClip(&amp;#x27;内容&amp;#x27;)&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;Copy&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;javascript&quot;&gt;&lt;a href=&quot;#javascript&quot; class=&quot;headerlink&quot; title=&quot;javascript:&quot;&gt;&lt;/a&gt;javascript:&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * 复制内容到粘贴板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * content : 需要复制的内容&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * message : 复制完后的提示，不传则默认提示&amp;quot;复制成功&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;copyToClip&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;content, message&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; aux = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.createElement(&lt;span class=&quot;string&quot;&gt;&amp;#x27;input&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    aux.setAttribute(&lt;span class=&quot;string&quot;&gt;&amp;#x27;value&amp;#x27;&lt;/span&gt;, content)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.body.appendChild(aux)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    aux.select()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.execCommand(&lt;span class=&quot;string&quot;&gt;&amp;#x27;copy&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.body.removeChild(aux)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (message == &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        alert(&lt;span class=&quot;string&quot;&gt;&amp;#x27;复制成功&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        alert(mesage)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript的静态作用域链与“动态”闭包链</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E7%9A%84%E9%9D%99%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E4%B8%8E%E2%80%9C%E5%8A%A8%E6%80%81%E2%80%9D%E9%97%AD%E5%8C%85%E9%93%BE/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/JavaScript%E7%9A%84%E9%9D%99%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E4%B8%8E%E2%80%9C%E5%8A%A8%E6%80%81%E2%80%9D%E9%97%AD%E5%8C%85%E9%93%BE/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>读完本文会解答你以下疑问：</p><ul><li>静态作用域链和动态作用域链的区别</li><li>为什么会有闭包</li><li>闭包什么时候创建的</li><li>[[scopes]] 属性是什么</li><li>闭包保存什么内容</li><li>闭包存储在哪</li><li>为什么 eval 性能不好</li><li>eval 什么情况下会创建闭包</li></ul><p>在 JavaScript 里面，函数、块、模块都可以形成作用域（一个存放变量的独立空间），他们之间可以相互嵌套，作用域之间会形成引用关系，这条链叫做作用域链。</p><p>作用域链具体是什么样呢？</p><a id="more"></a><h2 id="静态作用域链"><a href="#静态作用域链" class="headerlink" title="静态作用域链"></a>静态作用域链</h2><p>比如这样一段代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> guang = <span class="string">&#x27;guang&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ssh = <span class="string">&#x27;ssh&#x27;</span>;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">func3</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> suzhe = <span class="string">&#x27;suzhe&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，有 guang、ssh、suzhe 3个变量，有 func、func2、func3 3个函数，还有一个块，他们之间的作用域链可以用babel查看一下。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&#x27;@babel/parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&#x27;@babel/traverse&#x27;</span>).default;</span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">  function func() &#123;</span></span><br><span class="line"><span class="string">    const guang = &#x27;guang&#x27;;</span></span><br><span class="line"><span class="string">    function func2() &#123;</span></span><br><span class="line"><span class="string">      const ssh = &#x27;ssh&#x27;;</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        function func3 () &#123;</span></span><br><span class="line"><span class="string">          const suzhe = &#x27;suzhe&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ast = parser.parse(code);</span><br><span class="line"></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">  FunctionDeclaration (path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.get(<span class="string">&#x27;id.name&#x27;</span>).node === <span class="string">&#x27;func3&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(path.scope.dump());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>结果是<br><img src="/images/72f12fc7e7164cc0af23f3e16f03bb06~tplv-k3u1fbpfcp-watermark.image.png"></p><p>用图可视化一下就是这样的<br><img src="/images/df0acc1d0b904b8194b87622ac66f097~tplv-k3u1fbpfcp-watermark.image.png"></p><p>函数和块的作用域内的变量声明会在作用域 （scope） 内创建一个绑定（变量名绑定到具体的值，也就是 binding），然后其余地方可以引用 （refer） 这个 binding，这样就是静态作用域链的变量访问顺序。</p><p><strong>为什么叫“静态”呢？</strong></p><p>因为这样的嵌套关系是分析代码就可以得出的，不需要运行，按照这种顺序访问变量的链就是静态作用域链，这种链的好处是可以直观的知道变量之间的引用关系。</p><p>相对的，还有动态作用域链，也就是作用域的引用关系与嵌套关系无关，与执行顺序有关，会在执行的时候动态创建不同函数、块的作用域的引用关系。缺点就是不直观，没法静态分析。</p><p>静态作用域链是可以做静态分析的，比如我们刚刚用 babel 分析的 scope 链就是。所以绝大多数编程语言都是作用域链设计都是选择静态的顺序。</p><p>但是，JavaScript 除了静态作用域链外，还有一个特点就是函数可以作为返回值。比如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> f2 = func();</span><br></pre></td></tr></table></figure><p>这就导致了一个问题，本来按照顺序创建调用一层层函数，按顺序创建和销毁作用域挺好的，但是如果内层函数返回了或者通过别的暴露出去了，那么外层函数销毁，内层函数却没有销毁，这时候怎么处理作用域，父作用域销不销毁？ （比如这里的 func 调用结束要不要销毁作用域）</p><h2 id="不按顺序的函数调用与闭包"><a href="#不按顺序的函数调用与闭包" class="headerlink" title="不按顺序的函数调用与闭包"></a>不按顺序的函数调用与闭包</h2><p>比如把上面的代码做下改造，返回内部函数，然后在外面调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> guang = <span class="string">&#x27;guang&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ssh = <span class="string">&#x27;ssh&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func3</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> suzhe = <span class="string">&#x27;suzhe&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> func3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> func2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> func2 = func();</span><br></pre></td></tr></table></figure><p>当调用 func2 的时候 func1 已经执行完了，这时候销不销毁 ？于是 JavaScript 就设计了闭包的机制。</p><h3 id="闭包怎么设计？"><a href="#闭包怎么设计？" class="headerlink" title="闭包怎么设计？"></a>闭包怎么设计？</h3><p>先不看答案，考虑一下我们解决这个静态作用域链中的父作用域先于子作用域销毁怎么解决。</p><p><strong>首先，父作用域要不要销毁？ 是不是父作用域不销毁就行了？</strong></p><p>不行的，父作用域中有很多东西与子函数无关，为啥因为子函数没结束就一直常驻内存。这样肯定有性能问题，所以还是要销毁。 但是销毁了父作用域不能影响子函数，所以要再创建个对象，要把子函数内引用（refer）的父作用域的变量打包里来，给子函数打包带走。</p><p><strong>怎么让子函数打包带走？</strong></p><p>设计个独特的属性，比如 [[<code>Scopes</code>]]，用这个来放函数打包带走的用到的环境。并且这个属性得是一个栈，因为函数有子函数、子函数可能还有子函数，每次打包都要放在这里一个包，所以就要设计成一个栈结构，就像饭盒有多层一样。</p><p>我们所考虑的这个解决方案：销毁父作用域后，把用到的变量包起来，打包给子函数，放到一个属性上。这就是闭包的机制。</p><p>我们来试验一下闭包的特性：<br><img src="/images/6c21f15ec42443b892baa191e9bcf898~tplv-k3u1fbpfcp-watermark.image.png"></p><p>这个 func3 需不需要打包一些东西？ 会不会有闭包？<br><img src="/images/88178215cc7d4e76a77df1add6de120e~tplv-k3u1fbpfcp-watermark.image.png"></p><p>其实还是有闭包的，闭包最少会包含全局作用域。</p><p>但是为啥 guang、ssh、suzhe 都没有 ？ suzhe是因为不是外部的，只有外部变量的时候才会生成，比如我们改动下代码，打印下这 3 个变量。<br><img src="/images/a96d6398cb6941c0a953e50b14271111~tplv-k3u1fbpfcp-watermark.image.png"></p><p>再次查看 [[<code>Scopes</code>]] （打包带走的闭包环境）：<br><img src="/images/0a1d1964e1cb40ada4b3eeeffbebd5af~tplv-k3u1fbpfcp-watermark.image.png"></p><p>这时候就有俩闭包了，为什么呢？ suzhe 哪去了？</p><p>首先，我们需要打包的只是环境内没有的，也就是闭包只保存外部引用。然后是在创建函数的时候保存到函数属性上的，创建的函数返回的时候会打包给函数，但是 JS 引擎怎么知道它要用到哪些外部引用呢，需要做 AST 扫描，很多 JS 引擎会做 Lazy Parsing，这时候去 parse 函数，正好也能知道它用到了哪些外部引用，然后把这些外部用打包成 Closure 闭包，加到 [[scopes]] 中。</p><p>所以， <strong>闭包是返回函数的时候扫描函数内的标识符引用，把用到的本作用域的变量打成 Closure 包，放到 [[Scopes]] 里。</strong></p><p>所以上面的函数会在 func3 返回的时候扫描函数内的标识符，把 guang、ssh 扫描出来了，就顺着作用域链条查找这俩变量，过滤出来打包成两个 Closure（因为属于两个作用域，所以生成两个 Closure），再加上最外层 Global，设置给函数 func3 的 [[scopes]] 属性，让它打包带走。</p><p>调用 func3 的时候，JS 引擎 会取出 [[Scopes]] 中的打包的 Closure + Global 链，设置成新的作用域链， 这就是函数用到的所有外部环境了，有了外部环境，自然就可以运行了。</p><p>这里思考一个问题： 调试代码的时候为什么遇到过某个变量明明在作用域内能访问到，但就是没有相关信息呢？</p><p><img src="/images/2679bca268984d4893bb01f24257ce39~tplv-k3u1fbpfcp-watermark.image.png"></p><p>这个 traverse，明明能访问到的，为啥就是不显示信息呢？是 debugger 做的太烂了么？</p><p>不是的，如果你不知道原因，那是因为你还不理解闭包，因为这个 FunctionDeclaration 的函数是一个回调函数，明显是在另一个函数内调用的，就需要在创建的时候打包带走这个环境内的东西，根据只打包必要的环境的原则（不浪费内存），traverse 没有被引用（refer），自然就不打包了。并不是 debugger 有 bug 了。</p><p>所以我们只要访问一下，就能在调试的时候访问到了。</p><p><img src="/images/219a40756ad2432d969c077b18ab656d~tplv-k3u1fbpfcp-watermark.image.png"></p><p>是不是突然知道为啥调试的时候不能看一些变量的信息了，能解释清楚这个现象，就算理解闭包了。</p><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p>再来思考一个问题： 闭包需要扫描函数内的标识符，做静态分析，那 eval 怎么办，他有可能内容是从网络记载的，从磁盘读取的等等，内容是动态的。用静态去分析动态是不可能没 bug 的。怎么办？</p><p>没错，eval 确实没法分析外部引用，也就没法打包闭包，这种就特殊处理一下，打包整个作用域就好了。</p><p>验证一下：</p><p><img src="/images/f15d3641cc7845669300c78a7e88eb11~tplv-k3u1fbpfcp-watermark.image.png"></p><p>这个就像上面所说的，会把外部引用的打包成闭包</p><p><img src="/images/143b186936554141aa84525a708c7eea~tplv-k3u1fbpfcp-watermark.image.png"></p><p>这个就是 eval 的实现，因为没法静态分析动态内容所以全部打包成闭包了，本来闭包就是为了不保存全部的作用域链的内容，结果 eval 导致全部保存了，所以尽量不要用 eval。会导致闭包保存内容过多。</p><p><img src="/images/e1d4d856b2484661beac889915761bcc~tplv-k3u1fbpfcp-watermark.image.png"></p><p>但是 JS 引擎只处理了直接调用，也就是说直接调用 eval 才会打包整个作用域，如果不直接调用 eval，就没法分析引用，也就没法形成闭包了。</p><p>这种特殊情况有的时候还能用来完成一些黑魔法，比如利用不直接调用 eval 不会生成闭包，会在全局上下文执行的特性。</p><h2 id="给闭包下个定义"><a href="#给闭包下个定义" class="headerlink" title="给闭包下个定义"></a>给闭包下个定义</h2><p>用我们刚刚的试验来给闭包下个定义：</p><p><strong>闭包是在函数创建的时候，让函数打包带走的根据函数内的外部引用来过滤作用域链剩下的链。它是在函数创建的时候生成的作用域链的子集，是打包的外部环境。evel 因为没法分析内容，所以直接调用会把整个作用域打包（所以尽量不要用 eval，容易在闭包保存过多的无用变量），而不直接调用则没有闭包。</strong></p><p>过滤规则：</p><ol><li><p>全局作用域不会被过滤掉，一定包含。所以在何处调用函数都能访问到。</p></li><li><p>其余作用域会根据是否内部有变量被当前函数所引用而过滤掉一些。不是每个返回的子函数都会生成闭包。</p></li><li><p>被引用的作用域也会过滤掉没有被引用的 binding （变量声明）。只把用到的变量打个包。</p></li></ol><h2 id="闭包的缺点"><a href="#闭包的缺点" class="headerlink" title="闭包的缺点"></a>闭包的缺点</h2><p>JavaScript 是静态作用域的设计，闭包是为了解决子函数晚于父函数销毁的问题，我们会在父函数销毁时，把子函数引用到的变量打成 Closure 包放到函数的 [[Scopes]] 上，让它计算父函数销毁了也随时随地能访问外部环境。</p><p>这样设计确实解决了问题，但是有没有什么缺点呢？</p><p>其实问题就在于这个 [[Scopes]] 属性上</p><p>我们知道 JavaScript 引擎会把内存分为函数调用栈、全局作用域和堆，其中堆用于放一些动态的对象，调用栈每一个栈帧放一个函数的执行上下文，里面有一个 local 变量环境用于放内部声明的一些变量，如果是对象，会在堆上分配空间，然后把引用保存在栈帧的 local 环境中。全局作用域也是一样，只不过一般用于放静态的一些东西，有时候也叫静态域。</p><p><img src="/images/41c5c82d485b469ca92a36aec5b73ac0~tplv-k3u1fbpfcp-watermark.image.png"></p><p>每个栈帧的执行上下文包含函数执行需要访问的所有环境，包括 local 环境、作用域链、this等。</p><p>那么如果子函数返回了会发生什么呢？</p><p>首先父函数的栈帧会销毁，子函数这个时候其实还没有被调用，所以还是一个堆中的对象，没有对应的栈帧，这时候父函数把作用域链过滤出需要用到的，形成闭包链，设置到子函数的 [[Scopes]] 属性上。</p><p><img src="/images/473fde71299f47fd81bc4d2e1cbd90bb~tplv-k3u1fbpfcp-watermark.image.png"></p><p>父函数销毁，栈帧对应的内存马上释放，用到的 ssh Obj 会被 gc 回收，而返回的函数会把作用域链过滤出用到的引用形成闭包链放在堆中。 这就导致了一个隐患： 如果一个很大的对象被函数引用，本来函数调用结束就能销毁，但是现在引用却被通过闭包保存到了堆里，而且还一直用不到，那这块堆内存就一直没法使用，严重到一定程度就算是内存泄漏了。所以闭包不要乱用，少打包一点东西到堆内存。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们从静态作用域开始聊起，明确了什么是作用域，通过 babel 静态分析了一下作用域，了解了下静态和动态作用域，然后引入了子函数先于父函数销毁的问题，思考了下方案，然后引入了闭包的概念，分析下闭包生成的流程，保存的位置。我们还用闭包的特性分析了下为什么有时候调试的时候查看不了变量信息，之后分析了下 eval 为什么没法精确生成闭包，什么时候全部打包作用域、什么时候不生成闭包， eval 为什么会导致内存占用过多。之后分析了下带有闭包的函数在内存中的特点，解释了下为啥可能会内存泄漏。</p><p>闭包是在返回一个函数的时候，为了把环境保存下载，创建的一个快照，对作用域链做了tree shking，只留下必要的闭包链，保存在堆里，作为对象的 [[scopes]] 属性，让函数不管走到哪，随时随地可访问用到的外部环境。在执行这个函数的时候，会利用这个“快照”，恢复作用域链。</p><p>因为还没执行函数，所以要静态分析标识符引用。静态分析动态这件事情被无数个框架证明做不了，所以返回的函数有eval 只能全部打包或者不生成闭包。类似webpack 的动态import没法分析一样。</p><p><a href="https://juejin.cn/post/6957913856488243237">JavaScript 的静态作用域链与“动态”闭包链</a></p><p>#javascript/closure</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;读完本文会解答你以下疑问：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;静态作用域链和动态作用域链的区别&lt;/li&gt;
&lt;li&gt;为什么会有闭包&lt;/li&gt;
&lt;li&gt;闭包什么时候创建的&lt;/li&gt;
&lt;li&gt;[[scopes]] 属性是什么&lt;/li&gt;
&lt;li&gt;闭包保存什么内容&lt;/li&gt;
&lt;li&gt;闭包存储在哪&lt;/li&gt;
&lt;li&gt;为什么 eval 性能不好&lt;/li&gt;
&lt;li&gt;eval 什么情况下会创建闭包&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 JavaScript 里面，函数、块、模块都可以形成作用域（一个存放变量的独立空间），他们之间可以相互嵌套，作用域之间会形成引用关系，这条链叫做作用域链。&lt;/p&gt;
&lt;p&gt;作用域链具体是什么样呢？&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
    <category term="closure" scheme="https://tangxiaomi.top/tags/closure/"/>
    
  </entry>
  
  <entry>
    <title>Object.assign是浅拷贝还是深拷贝？实现深拷贝的方法有哪些？</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/Object.assign%E6%98%AF%E6%B5%85%E6%8B%B7%E8%B4%9D%E8%BF%98%E6%98%AF%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%9F%E5%AE%9E%E7%8E%B0%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/Object.assign%E6%98%AF%E6%B5%85%E6%8B%B7%E8%B4%9D%E8%BF%98%E6%98%AF%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%9F%E5%AE%9E%E7%8E%B0%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Object.assign() 方法用于将所有可枚举属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。  </p></blockquote><ul><li><p>如果目标对象中的属性具有相同的键，则属性将被源对象中的属性覆盖。后面的源对象的属性将类似地覆盖前面的源对象的属性。</p></li><li><p>Object.assign 方法只会拷贝源对象自身的并且可枚举的属性到目标对象。该方法使用源对象的[[Get]]和目标对象的[[Set]]，所以它会调用相关 getter 和 setter。因此，它分配属性，而不仅仅是复制或定义新的属性。如果合并源包含getter，这可能使其不适合将新属性合并到原型中。为了将属性定义（包括其可枚举性）复制到原型，应使用Object.getOwnPropertyDescriptor()和Object.defineProperty() 。</p></li><li><p>String类型和 Symbol 类型的属性都会被拷贝。</p></li><li><p>在出现错误的情况下，例如，如果属性不可写，会引发TypeError，如果在引发错误之前添加了任何属性，则可以更改target对象。</p></li><li><p>Object.assign 不会在那些source对象值为 <code>null</code> 或 <code>undefined</code> 的时候抛出错误。</p></li><li><p>针对 <strong>深拷贝</strong> ，需要使用其他办法，因为 Object.assign()拷贝的是属性值。假如源对象的属性值是一个对象的引用，那么它也只指向那个引用。也就是说，如果对象的属性值为简单类型（如string， number），通过Object.assign({},srcObj);得到的新对象为 <code>深拷贝</code> ；如果属性值为对象或其它引用类型，那对于这个对象而言其实是 <code>浅拷贝</code> 的。</p><a id="more"></a><blockquote><p>用 JSON.stringify 把对象转换成字符串，再用 JSON.parse 把字符串转换成新的对象。  </p></blockquote></li></ul><p>可以转成 JSON 格式的对象才能使用这种方法，如果对象中包含 function 或 RegExp 这些就不能用这种方法了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过js的内置对象JSON来进行数组对象的深拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _obj = <span class="built_in">JSON</span>.stringify(obj);</span><br><span class="line">  <span class="keyword">let</span> objClone = <span class="built_in">JSON</span>.parse(_obj);</span><br><span class="line">  <span class="keyword">return</span> objClone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Object-assign-拷贝"><a href="#Object-assign-拷贝" class="headerlink" title="Object.assign()拷贝"></a>Object.assign()拷贝</h3><p>当对象中只有一级属性，没有二级属性的时候，此方法为深拷贝，但是对象中有对象的时候，此方法，在二级属性以后就是浅拷贝。</p><h3 id="通过jQuery的extend方法实现深拷贝"><a href="#通过jQuery的extend方法实现深拷贝" class="headerlink" title="通过jQuery的extend方法实现深拷贝"></a>通过jQuery的extend方法实现深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">   <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">b</span>: &#123;</span><br><span class="line">     <span class="attr">f</span>: &#123;</span><br><span class="line">       <span class="attr">g</span>: <span class="number">1</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = $.extend(<span class="literal">true</span>, &#123;&#125;, obj1);</span><br></pre></td></tr></table></figure><h3 id="lodash-cloneDeep-实现深拷贝"><a href="#lodash-cloneDeep-实现深拷贝" class="headerlink" title="lodash.cloneDeep()实现深拷贝"></a>lodash.cloneDeep()实现深拷贝</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let _ = require(&#x27;lodash&#x27;);</span><br><span class="line">let obj1 = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: &#123; f: &#123; g: 1 &#125; &#125;,</span><br><span class="line">    c: [1, 2, 3]</span><br><span class="line">&#125;;</span><br><span class="line">let obj2 = _.cloneDeep(obj1);</span><br></pre></td></tr></table></figure><h3 id="使用递归的方式实现深拷贝"><a href="#使用递归的方式实现深拷贝" class="headerlink" title="使用递归的方式实现深拷贝"></a>使用递归的方式实现深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_deepClone</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    target = <span class="built_in">Array</span>.isArray(source) ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">      <span class="keyword">if</span> (source.hasOwnProperty(key)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> source[key] !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">          target[key] = source[key]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          target[key] = _deepClone(source[key])</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    target = source</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/LVBingo/p/11290637.html">经典前端面试题: Object.assign 是浅拷贝还是深拷贝？实现深拷贝的方法有哪些？</a></p><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Object.assign() 方法用于将所有可枚举属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;如果目标对象中的属性具有相同的键，则属性将被源对象中的属性覆盖。后面的源对象的属性将类似地覆盖前面的源对象的属性。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Object.assign 方法只会拷贝源对象自身的并且可枚举的属性到目标对象。该方法使用源对象的[[Get]]和目标对象的[[Set]]，所以它会调用相关 getter 和 setter。因此，它分配属性，而不仅仅是复制或定义新的属性。如果合并源包含getter，这可能使其不适合将新属性合并到原型中。为了将属性定义（包括其可枚举性）复制到原型，应使用Object.getOwnPropertyDescriptor()和Object.defineProperty() 。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;String类型和 Symbol 类型的属性都会被拷贝。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在出现错误的情况下，例如，如果属性不可写，会引发TypeError，如果在引发错误之前添加了任何属性，则可以更改target对象。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Object.assign 不会在那些source对象值为 &lt;code&gt;null&lt;/code&gt; 或 &lt;code&gt;undefined&lt;/code&gt; 的时候抛出错误。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;针对 &lt;strong&gt;深拷贝&lt;/strong&gt; ，需要使用其他办法，因为 Object.assign()拷贝的是属性值。假如源对象的属性值是一个对象的引用，那么它也只指向那个引用。也就是说，如果对象的属性值为简单类型（如string， number），通过Object.assign({},srcObj);得到的新对象为 &lt;code&gt;深拷贝&lt;/code&gt; ；如果属性值为对象或其它引用类型，那对于这个对象而言其实是 &lt;code&gt;浅拷贝&lt;/code&gt; 的。&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>nodejs搭建本地服务器展示文件夹</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/nodejs%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B1%95%E7%A4%BA%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/nodejs%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B1%95%E7%A4%BA%E6%96%87%E4%BB%B6%E5%A4%B9/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">80</span></span><br><span class="line"><span class="keyword">var</span> serveIndex = <span class="built_in">require</span>(<span class="string">&#x27;serve-index&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">&#x27;../&#x27;</span>))</span><br><span class="line">app.use(serveIndex(<span class="string">&#x27;../&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIPAdress</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> interfaces = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).networkInterfaces()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> devName <span class="keyword">in</span> interfaces) &#123;</span><br><span class="line">        <span class="keyword">var</span> iface = interfaces[devName]</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; iface.length; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> alias = iface[i]</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                alias.family === <span class="string">&#x27;IPv4&#x27;</span> &amp;&amp;</span><br><span class="line">                alias.address !== <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp;</span><br><span class="line">                !alias.internal</span><br><span class="line">            ) &#123;</span><br><span class="line">                <span class="comment">// console.log(alias.address);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> alias.address</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(app)</span><br><span class="line"></span><br><span class="line">server.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Example app listening at http://<span class="subst">$&#123;getIPAdress()&#125;</span>:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>#javascript/nodejs</p>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
    <category term="nodejs" scheme="https://tangxiaomi.top/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>偏函数</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/%E5%81%8F%E5%87%BD%E6%95%B0/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/%E5%81%8F%E5%87%BD%E6%95%B0/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>偏函数是 [[函数柯里化]]  运算的一种特定应用场景。简单描述，就是把一个函数的某些参数先固化，也就是设置默认值，返回一个新的函数，在新函数中继续接收剩余参数，这样调用这个新函数会更简单。</p><p><strong>下面是一个类型检测函数，接收两个参数，第 1 个表示类型字符串，第 2 个表示检测的数据。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isType = <span class="function"><span class="keyword">function</span> (<span class="params">type, obj</span>) </span>&#123;  <span class="comment">//偏函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">&#x27;[object &#x27;</span> + type + <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>该函数包含两个设置参数，使用时比较繁琐。一般常按以下方式进行设计。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isString = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">&#x27;[object  String]&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isFunction = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">&#x27;[object  Function]&#x27;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>函数接收的参数单一，检测的功能也单一和明确，这样更便于在表达式运算中有针对性的调用。下面对 isType() 函数进行扁平化设计，代码如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isType = <span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">&#x27;[object &#x27;</span> + type + <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然后根据 JS 偏函数获取不同类型检测函数。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isString = isType(<span class="string">&quot;String&quot;</span>);  <span class="comment">//专一功能检测函数，检测字符串</span></span><br><span class="line"><span class="keyword">var</span> isFunction = isType(<span class="string">&quot;Function&quot;</span>);  <span class="comment">//专一功能检测函数，检测字符串</span></span><br></pre></td></tr></table></figure><p><strong>应用代码如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(isString(<span class="string">&quot;12&quot;</span>));  <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(isFunction(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;));  <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(isFunction(&#123;&#125;));  <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><strong>下面示例设计一个 wrap() 偏函数，该函数的主要功能是产生一个 HTML 包裹函数，即样式标签。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrap</span>(<span class="params">tag</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stag = <span class="string">&#x27;&lt;&#x27;</span> + tag + <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> etag = <span class="string">&#x27;&lt;/&#x27;</span> + tag.replace(<span class="regexp">/s.*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stag + x + etag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = wrap(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(b(<span class="string">&#x27;粗体字&#x27;</span>));</span><br><span class="line"><span class="keyword">var</span> i = wrap(<span class="string">&#x27;i&#x27;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(i(<span class="string">&#x27;斜体字&#x27;</span>));</span><br><span class="line"><span class="keyword">var</span> u = wrap(<span class="string">&#x27;u&#x27;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(u(<span class="string">&#x27;下划线字&#x27;</span>));</span><br></pre></td></tr></table></figure><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;偏函数是 [[函数柯里化]]  运算的一种特定应用场景。简单描述，就是把一个函数的某些参数先固化，也就是设置默认值，返回一个新的函数，在新函数中继续接收剩余参数，这样调用这个新函数会更简单。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;下面是一个类型检测函数，接收两个参数，第 1 个表示类型字符串，第 2 个表示检测的数据。&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; isType = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;type, obj&lt;/span&gt;) &lt;/span&gt;&amp;#123;  &lt;span class=&quot;comment&quot;&gt;//偏函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.prototype.toString.call(obj) == &lt;span class=&quot;string&quot;&gt;&amp;#x27;[object &amp;#x27;&lt;/span&gt; + type + &lt;span class=&quot;string&quot;&gt;&amp;#x27;]&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>函数柯里化</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96">柯里化 - 维基百科，自由的百科全书</a><br>把接受多个<code>参数</code>的<code>函数</code>变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。  </p></blockquote><h2 id="柯里化有3个常见作用："><a href="#柯里化有3个常见作用：" class="headerlink" title="柯里化有3个常见作用："></a>柯里化有3个常见作用：</h2><ol><li>参数复用</li><li>提前确定</li><li>延迟计算/运行</li></ol><h2 id="基本实现"><a href="#基本实现" class="headerlink" title="基本实现"></a>基本实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * a + b * b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用上述函数：<code>(foo(3))(4)</code>，或直接<code>foo(3)(4)</code></p><a id="more"></a><h2 id="参数复用"><a href="#参数复用" class="headerlink" title="参数复用"></a>参数复用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常正则验证字符串 reg.test(txt)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数封装后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">reg, txt</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> reg.test(txt)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check(<span class="regexp">/\d+/g</span>, <span class="string">&#x27;test&#x27;</span>)       <span class="comment">//false</span></span><br><span class="line">check(<span class="regexp">/[a-z]+/g</span>, <span class="string">&#x27;test&#x27;</span>)    <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Currying后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curryingCheck</span>(<span class="params">reg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">txt</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reg.test(txt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hasNumber = curryingCheck(<span class="regexp">/\d+/g</span>)</span><br><span class="line"><span class="keyword">var</span> hasLetter = curryingCheck(<span class="regexp">/[a-z]+/g</span>)</span><br><span class="line"></span><br><span class="line">hasNumber(<span class="string">&#x27;test1&#x27;</span>)      <span class="comment">// true</span></span><br><span class="line">hasNumber(<span class="string">&#x27;testtest&#x27;</span>)   <span class="comment">// false</span></span><br><span class="line">hasLetter(<span class="string">&#x27;21212&#x27;</span>)      <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>上面的示例是一个正则的校验，正常来说直接调用check函数就可以了，但是如果我有很多地方都要校验是否有数字，其实就是需要将第一个参数reg进行复用，这样别的地方就能够直接调用hasNumber，hasLetter等函数，让参数能够复用，调用起来也更方便。</p><h2 id="提前确定"><a href="#提前确定" class="headerlink" title="提前确定"></a>提前确定</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMap</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> map = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">var</span> list = str.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">    map[list[i]] = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map[val.toLowerCase()];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isHTMLTag = makeMap(</span><br><span class="line">    <span class="string">&#x27;html,body,base,head,link,meta,style,title,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;embed,object,param,source,canvas,script,noscript,del,ins,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;caption,col,colgroup,table,thead,tbody,td,th,tr,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;output,progress,select,textarea,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;details,dialog,menu,menuitem,summary,&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;content,element,shadow,template,blockquote,iframe,tfoot&#x27;</span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure><p>这是vue源码中的一个方法，用这个方法来判断当前自定义标签跟html，这里就用了提前确认， 先将所有的标签都存入一个对象，然后每次查找只需要匹配对象里面是否存在该标签，这样就能防止多次循环遍历查找对应的标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isHTMLTag(<span class="string">&#x27;div&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="延迟执行"><a href="#延迟执行" class="headerlink" title="延迟执行"></a>延迟执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curryAdd = <span class="function"><span class="keyword">function</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _args = rest</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rest.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> _args.reduce(<span class="function">(<span class="params">sum, single</span>) =&gt;</span> sum += single)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _args.push(...rest)</span><br><span class="line">      <span class="keyword">return</span> cb</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;()                        <span class="comment">// 为了保存添加的数，这里要返回一个闭包</span></span><br><span class="line">curryAdd(<span class="number">1</span>)</span><br><span class="line">curryAdd(<span class="number">2</span>)</span><br><span class="line">curryAdd(<span class="number">3</span>)</span><br><span class="line">curryAdd(<span class="number">4</span>)</span><br><span class="line">curryAdd()               <span class="comment">// 最后计算输出:10</span></span><br></pre></td></tr></table></figure><h2 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现一个add方法，使计算结果能够满足如下预期：</span></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>) = <span class="number">6</span>;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>) = <span class="number">10</span>;</span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>) = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 第一次执行时，定义一个数组专门用来存储所有的参数</span></span><br><span class="line">    <span class="keyword">var</span> _args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在内部声明一个函数，利用闭包的特性保存_args并收集所有的参数值</span></span><br><span class="line">    <span class="keyword">var</span> _adder = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        _args.push(...arguments);</span><br><span class="line">        <span class="keyword">return</span> _adder;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 利用toString隐式转换的特性，当最后执行时隐式转换，并计算最终的值返回</span></span><br><span class="line">    _adder.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _args.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _adder;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)                <span class="comment">// 6</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>)             <span class="comment">// 10</span></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>)          <span class="comment">// 15</span></span><br><span class="line">add(<span class="number">2</span>, <span class="number">6</span>)(<span class="number">1</span>)                <span class="comment">// 9</span></span><br></pre></td></tr></table></figure><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96&quot;&gt;柯里化 - 维基百科，自由的百科全书&lt;/a&gt;&lt;br&gt;把接受多个&lt;code&gt;参数&lt;/code&gt;的&lt;code&gt;函数&lt;/code&gt;变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;柯里化有3个常见作用：&quot;&gt;&lt;a href=&quot;#柯里化有3个常见作用：&quot; class=&quot;headerlink&quot; title=&quot;柯里化有3个常见作用：&quot;&gt;&lt;/a&gt;柯里化有3个常见作用：&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;参数复用&lt;/li&gt;
&lt;li&gt;提前确定&lt;/li&gt;
&lt;li&gt;延迟计算/运行&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;基本实现&quot;&gt;&lt;a href=&quot;#基本实现&quot; class=&quot;headerlink&quot; title=&quot;基本实现&quot;&gt;&lt;/a&gt;基本实现&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; foo = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;a&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;b&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a * a + b * b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;调用上述函数：&lt;code&gt;(foo(3))(4)&lt;/code&gt;，或直接&lt;code&gt;foo(3)(4)&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>揭开在线协作的神秘面纱–OT算法</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/%E6%8F%AD%E5%BC%80%E5%9C%A8%E7%BA%BF%E5%8D%8F%E4%BD%9C%E7%9A%84%E7%A5%9E%E7%A7%98%E9%9D%A2%E7%BA%B1%E2%80%93OT%E7%AE%97%E6%B3%95/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/%E6%8F%AD%E5%BC%80%E5%9C%A8%E7%BA%BF%E5%8D%8F%E4%BD%9C%E7%9A%84%E7%A5%9E%E7%A7%98%E9%9D%A2%E7%BA%B1%E2%80%93OT%E7%AE%97%E6%B3%95/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>相信大家或多或少都有使用过在线文档，国内的像我们在做的 <a href="http://https//docs.qq.com/desktop/">腾讯文档</a> 还有其他家的很多类似产品。今天主要为大家揭开在线协作的神秘面纱，那就是 OT 算法。</p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在线文档，抽象一下，这些产品的模式都是富文本编辑器+后台，富文本编辑器产生内容，展示内容，然后后台负责保存。<br>富文本编辑器现在业界已经有很多成熟的产品，像 <a href="https://codemirror.net/">codeMirror</a> ，这一块本身也是很复杂的一块，也不是咱们这次关注的重点方向。<br>不知道大家平常在用这些产品的时候有没有思考过一个问题，在线文档编辑的时候产生冲突怎么办？</p><a id="more"></a><h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>举个很简单的例子，现在大家的文本都是 ‘aaab’，A 用户在第 3 个字符行后面插入了一个 ‘c’，B 用户在第 3 个字符行后面插入了一个 ‘d’，这个时候 A 这边看到的是 ‘aaacb’，B 这边看到的是 ‘aaadb’, 我们假设 A 用户先提交了数据，那其实最后预期的数据其实应该是 ‘aaacdb’，这样就最大的保存了每个人的输入。 那我们现在来看看正常情况下这里会发生什么：</p><p>A 用户：</p><blockquote><p>A 本地已经是 ‘aaacb’ 了，过一会儿，后台告诉它 B 也编辑了，编辑的行为就是 <strong>第 3 个字符行后面插入了一个 ‘d’</strong> ，那 A 这边执行了这个行为，最终变成了 ‘aaadcb’  </p></blockquote><p>B 用户：</p><blockquote><p>B 本地已经是 ‘aaadb’ 了，过一会儿，后台告诉它 A 也编辑了，编辑的行为就是 <strong>第 3 个字符行后面插入了一个 ‘c’</strong> ，那 B 这边执行了这个行为，最终变成了 ‘aaacdb’  </p></blockquote><p>从上面的模拟过程可以看到，A 用户最后的结果其实是不正确的，但是 B 是正确的。</p><p>这里先解释一下大家可能会疑惑的地方：为什么 B 是过一会儿后台告诉它 A 编辑了，不是说 A 先提交了数据吗？<br>其实这里针对的是冲突场景，这里如果 B 在提交之前，已经收到后台告诉它 A 编辑了，那其实就是顺序编辑了，也就不是冲突了。所以这里指的是 A，B 几乎同时提交，但是 A 到达后台还是快一点的，也就是 A，B 在编辑的时候是不知道彼此的存在的。</p><p>真实的冲突场景其实不是这种简单的时序问题，这里我后面再介绍。</p><h3 id="尝试解决"><a href="#尝试解决" class="headerlink" title="尝试解决"></a>尝试解决</h3><p>这里可能有一些聪明的小伙伴有了一些想法。</p><h4 id="解决方案一：丢了丢了"><a href="#解决方案一：丢了丢了" class="headerlink" title="解决方案一：丢了丢了"></a>解决方案一：丢了丢了</h4><p>这可能是最简单粗暴的方法了，我发现有冲突，就告诉用户，主子，咱这里有冲突了，臣妾解决不了啊。但是显然这会经常出现，然后主子就把你打入冷宫了。</p><h4 id="解决方案二：锁"><a href="#解决方案二：锁" class="headerlink" title="解决方案二：锁"></a>解决方案二：锁</h4><p>有些小伙伴想到，上面出现问题，还不是因为大家编辑了都立即应用了，我们编辑后不立即应用不就好了，而且历史告诉我们，有冲突加锁应该可以解决。那我们看看假如不立即应用，咱有没有什么处理办法：</p><p>A 用户：</p><blockquote><p>A 本地已经是 ‘aaab’ 了，A 编辑了，但是不应用，先发后台  </p></blockquote><p>B 用户：</p><blockquote><p>B 本地已经是 ‘aaab’ 了，B 编辑了，但是不应用，先发后台  </p></blockquote><p>后台：</p><blockquote><p>后台先收到 A 请求，然后加了一个锁，然后收到了 B 请求，这时侯应该是加锁的状态，所以接受了 A，拒绝了 B  </p></blockquote><p>A 用户：</p><blockquote><p>A 用户收到了后台的回复，告诉它你的提交我接收了  </p></blockquote><p>B 用户：</p><blockquote><p>B 用户收到了后台的回复，告诉它你的提交被我拒绝了，因为冲突了  </p></blockquote><p>这样虽然能继续下去，但是好像还是不太行的亚子啊，B 的提交还是丢了，所以好像和第一种简单粗暴的方法没啥区别</p><h3 id="OT-算法"><a href="#OT-算法" class="headerlink" title="OT 算法"></a>OT 算法</h3><p>顺其自然的，这个时候你会看到 OT 算法驾着七彩祥云来救你了～<br>其实回到上面的例子，本质问题还是因为后台通知大家的 B 的编辑行为看起来不太对。现在后台通知大家的是:</p><blockquote><p>B 的编辑的行为就是 <strong>第 3 个字符行后面插入了一个 ‘d’</strong>  </p></blockquote><p>但是在 A 已经接受的情况下，正确的通知应该是：</p><blockquote><p>B 的编辑的行为就是 <strong>第 4 个字符行后面插入了一个 ‘d’</strong>  </p></blockquote><p>假如我们把 A 提交的行为叫做 A，B 提交的行为叫做 B，现在后台就是一个简单的转发功能，告诉 A 的是 B，告诉 B 的是 A，然后就出现问题了。所以后台应该更聪明一点，它应该学会一个招术，那就是把每个人提交的行为转变一下再告诉别人，其实这个技术就是 OT 算法。</p><p>OT 算法全名叫 <strong>Operation Transformation</strong> ，你看从名字就对应了上面我说的转变算法。 假设我们的 OT 算法的转换功能叫 transform，那 transform（A，B）= A’,B’。 也就是说你输入两个先后执行的行为，它会告诉你两个转换过后的行为，然后把 A’行为告诉 B，把 B’行为告诉 A，这样大家再应用就相安无事了。</p><p><img src="/images/0973dffd-399c-48e9-8fcf-77ff3a6809e6-272x300.png"></p><p>上面的图是 OT 的经典菱形图，也就是说 A 会变成 A’在 B 这边执行，B 会变成 B’在 A 这边执行。 这里实际抽象一下，用户永远就只有两个人，一个是自己，一个是服务端，只是服务端的操作可能来自很多人，如果不这样抽象，那一个个进行冲突处理可能会让你觉得无法理解。</p><p>那我们现在再来看看后台有了 OT 这个能力之后会发生什么：</p><p>A 用户：</p><blockquote><p>A 本地已经是 ‘aaacb’ 了，过一会儿，后台告诉它 B 也编辑了，编辑的行为就是 <strong>第 4 个字符行后面插入了一个 ‘d’</strong> ，那 A 这边执行了这个行为，最终变成了 ‘aaacdb’  </p></blockquote><p>B 用户：</p><blockquote><p>B 本地已经是 ‘aaadb’ 了，过一会儿，后台告诉它 A 也编辑了，编辑的行为就是 <strong>第 3 个字符行后面插入了一个 ‘c’</strong> ，那 B 这边执行了这个行为，最终变成了 ‘aaacdb’  </p></blockquote><p>现在 A、B 就一致了！</p><h3 id="OT-算法的实现"><a href="#OT-算法的实现" class="headerlink" title="OT 算法的实现"></a>OT 算法的实现</h3><p>现在 OT 算法对我们来说就是一个黑盒，我们知道给一定的输入，它会有正确的输出，但是它是如何做到的呢？<br>在介绍它的实现之前，我们需要抽象一下我们的操作行为，在之前我们的描述都是</p><blockquote><p><strong>第 3 个字符行后面插入了一个 ‘d’</strong>  </p></blockquote><p>这里怎么转换成程序识别或者能用代码表达的呢？其实这也是 OT 的关键。 这里我直接揭晓答案：</p><p>所有对文本的操作都可以抽象成三个原子行为：</p><blockquote><p>R = Retain，保持操作 I = Insert，插入操作  </p></blockquote><blockquote><p>D = Delete，删除操作  </p></blockquote><p>那之前的行为</p><blockquote><p><strong>第 3 个字符行后面插入了一个 ‘d’</strong>  </p></blockquote><p>就会变成</p><blockquote><p>R(3), I(‘d’)  </p></blockquote><p>也就是保持三个字符后插入 1 个 ‘d’，其实应该也很好理解，这里的操作就像操作数组一样，不管干什么，第一步你得先找到操作的下标。<br>有了这三个原子以后，我们就可以看到：</p><blockquote><p>A = R(3),I(‘c’)<br>B = R(3), I(‘d’)  </p></blockquote><p>一切准备就绪，我们可以开始看 OT 了，这里 OT 算法现在已经很成熟了，这里我以一个 github 上的 repo 为例： <a href="https://github.com/Operational-Transformation/ot.js">ot.js</a><br>我们可以看看它的核心代码 (有删减，理解起来可能会比较复杂，感兴趣的可以深入思考一下)：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Transform takes two operations A and B that happened concurrently and</span></span><br><span class="line">  <span class="comment">// produces two operations A&#x27; and B&#x27; (in an array) such that</span></span><br><span class="line">  <span class="comment">// `apply(apply(S, A), B&#x27;) = apply(apply(S, B), A&#x27;)`. This function is the</span></span><br><span class="line">  <span class="comment">// heart of OT.</span></span><br><span class="line">  <span class="comment">// 上面这个公式就是OT的核心，它产生了A&#x27;,B&#x27;,同时保证执行结果一致，S就是我们开始的状态，可以把这个和菱形图对应起来</span></span><br><span class="line">  <span class="comment">// 整体执行流程有点像合并排序的过程。两个下标指针分别往前走</span></span><br><span class="line"> </span><br><span class="line">  TextOperation.transform = <span class="function"><span class="keyword">function</span> (<span class="params">operation1, operation2</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// operation1， operation2就是我们的A，B</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> operation1prime = <span class="keyword">new</span> TextOperation(); <span class="comment">// 就是A&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> operation2prime = <span class="keyword">new</span> TextOperation(); <span class="comment">// 就是B&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> ops1 = operation1.ops, ops2 = operation2.ops;</span><br><span class="line">    <span class="keyword">var</span> i1 = <span class="number">0</span>, i2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> op1 = ops1[i1++], op2 = ops2[i2++];</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="comment">// At every iteration of the loop, the imaginary cursor that both</span></span><br><span class="line">      <span class="comment">// operation1 and operation2 have that operates on the input string must</span></span><br><span class="line">      <span class="comment">// have the same position in the input string.</span></span><br><span class="line">      <span class="comment">// 其实这里就是说transform的核心是保证两者的下标一致，这样操作的才是同一个位置的数据</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="comment">// next two cases: one or both ops are insert ops</span></span><br><span class="line">      <span class="comment">// =&gt; insert the string in the corresponding prime operation, skip it in</span></span><br><span class="line">      <span class="comment">// the other one. If both op1 and op2 are insert ops, prefer op1.</span></span><br><span class="line">      <span class="comment">// 如果A是插入操作，A&#x27;一定也是插入，但是B&#x27;就不一样了，因为A是插入，不管你B是啥，你先等等，所以retain一下，保证下标一致</span></span><br><span class="line">      <span class="comment">// 这里实际上有三种情况，A是插入，B可能是R，I，D</span></span><br><span class="line">      <span class="keyword">if</span> (isInsert(op1)) &#123;</span><br><span class="line">        operation1prime.insert(op1);</span><br><span class="line">        operation2prime.retain(op1.length);</span><br><span class="line">        op1 = ops1[i1++];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果B也是插入，那B’就是插入，但是你的A&#x27;也得retain一下，保证下标一致</span></span><br><span class="line">      <span class="comment">// 这里可能有两者情况，A可能是R，D</span></span><br><span class="line">      <span class="comment">// 实例化思考一下，A [R(3),I(&#x27;a&#x27;)],B [I(&#x27;b&#x27;)],那对于A&#x27;来说就应该是[R(4),I(&#x27;a&#x27;)]</span></span><br><span class="line">      <span class="keyword">if</span> (isInsert(op2)) &#123;</span><br><span class="line">        operation1prime.retain(op2.length);</span><br><span class="line">        operation2prime.insert(op2);</span><br><span class="line">        op2 = ops2[i2++];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">var</span> minl;</span><br><span class="line">      <span class="keyword">if</span> (isRetain(op1) &amp;&amp; isRetain(op2)) &#123;</span><br><span class="line">        <span class="comment">// R和R处理</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDelete(op1) &amp;&amp; isDelete(op2)) &#123;</span><br><span class="line">        <span class="comment">//D和D处理</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDelete(op1) &amp;&amp; isRetain(op2)) &#123;</span><br><span class="line">       <span class="comment">// D和R处理</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isRetain(op1) &amp;&amp; isDelete(op2)) &#123;</span><br><span class="line">       <span class="comment">//R和D处理</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [operation1prime, operation2prime];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里就是 OT 的 transform 实现，本质上就是把用户的原子操作数组拿到以后，然后做 transform 操作，这里我只选了一小段来大概解析下，具体的可以看注释，其实原本的注释已经很全了。 其实上面那段代码，因为我们的原子操作只有三种，根据排列组合，最多只会有 9 种情况，只是上面把很多情况合并了，你要是不理解，也可以拆开，帮助理解。</p><p>其实上面的文件还有 compose，invert 等方法，但是其实 transform 才是我们理解的核心，其他方法大家感兴趣可以看看注释和下面贴的一些关于 OT 更详细介绍的文章。</p><h3 id="OT-算法的时序"><a href="#OT-算法的时序" class="headerlink" title="OT 算法的时序"></a>OT 算法的时序</h3><p>简单的 OT 大家只要理解了，好像也并不是很难，但是其实真实情况下 OT 会比想象的还要复杂，因为之前说的菱形会无限拓展。</p><p><img src="/images/6E64DEED-65D3-42F9-8485-59C84C0FCD6C-300x124.jpg"></p><p>简单理解一下，就是 A 本地产生了两次编辑，B 产生了一次。这里就必须要和大家解释一下之前遗留的时序问题了，不然可能无法理解。</p><p>之前说的时序都是指时间先后顺序，冲突也是指同时产生编辑。但是其实这里的同时不是时间上的同时，而是 <code>版本上的同时</code> 。 也就是说我们需要用一个东西表示每一个版本，类似 git 的每次提交，每次提交到服务端的时候就要告诉后端，我的修改是基于哪个版本的修改。</p><p>最简单的标志位就是 <code>递增的数字</code> 。那基于版本的冲突，可以简单理解为我们都是基于 100 版本的提交，那就是冲突了，也许我们并不是同时， <code>谁先到后台决定了谁先被接受而已</code> 。这里最夸张的就是离线编辑，可能正常版本已经到了 1000 了，某个用户因为离线了，本地的版本一直停留在 100，提交上来的版本是基于 100 的。</p><p>那有了时序的概念，我们再看上面这个菱形，它可以理解成 A 和 B 都基于 100 提交了数据，但是在 A 的提交还没被后台确认的时候，A 又编辑了，但是因为上一次提交没被确认，所以这次不会发到后台，这时服务器告诉它 B 基于 100 做了提交。</p><p>这种情况下如何处理，就有点类似于 OT 落地到实践当中，你怎么实现了，上面提到的 github 的那个 repo 的实现其实非常巧妙，你看完注释应该就能全部理解，这里给出 <a href="https://github.com/Operational-Transformation/ot.js/blob/8873b7e28e83f9adbf6c3a28ec639c9151a838ae/lib/client.js">代码链接</a></p><p>精华就在于它把本地分成了几个状态：</p><blockquote><p>Synchronized 没有正在提交并且等待回包的 operation AwaitingConfirm 有一个 operation 提交了但是等后台确认，本地没有编辑数据  </p></blockquote><blockquote><p>AwaitingWithBuffer 有一个 operation 提交了但是等后台确认，本地有编辑数据  </p></blockquote><p>剩下的就是在这三种状态下，收到了本地和服务端的数据，分别应该怎么处理</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>其实 OT 对应的只是一种思想，具体怎么实现是根据具体情况来区分的，比如我们现在讨论的就是文本的 OT，那有可能图的 OT、表格的 OT 又是其他的实现。OT 的核心就是 transform，而 transform 的核心就在于你怎么找到这样的原子操作了，然后原子操作的复杂度决定了 transform 实现的复杂度。</p><p>上面这个 repo 只是帮你实现了文本的协同处理，其实对于在线文档来说，还有样式的冲突处理，感兴趣的可以自己搜索相关资料了解一下，建议精读一下 ot.js 这个库。</p><p>最后如果读完这篇文章你对在线协作有了一定的认知，那这篇文章的使命也就达到了，最后如果有写的不正确的地方，欢迎斧正～</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="http://www.codecommit.com/blog/java/understanding-and-applying-operational-transformation">understanding-and-applying-operational-transformation</a><br><a href="https://github.com/Operational-Transformation/ot.js">ot.js</a></p><p><a href="http://www.alloyteam.com/2019/07/13659/">揭开在线协作的神秘面纱 – OT 算法</a></p><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;相信大家或多或少都有使用过在线文档，国内的像我们在做的 &lt;a href=&quot;http://https//docs.qq.com/desktop/&quot;&gt;腾讯文档&lt;/a&gt; 还有其他家的很多类似产品。今天主要为大家揭开在线协作的神秘面纱，那就是 OT 算法。&lt;/p&gt;
&lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;在线文档，抽象一下，这些产品的模式都是富文本编辑器+后台，富文本编辑器产生内容，展示内容，然后后台负责保存。&lt;br&gt;富文本编辑器现在业界已经有很多成熟的产品，像 &lt;a href=&quot;https://codemirror.net/&quot;&gt;codeMirror&lt;/a&gt; ，这一块本身也是很复杂的一块，也不是咱们这次关注的重点方向。&lt;br&gt;不知道大家平常在用这些产品的时候有没有思考过一个问题，在线文档编辑的时候产生冲突怎么办？&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>编写JavaScript的10个小技巧</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/%E7%BC%96%E5%86%99JavaScript%E7%9A%8410%E4%B8%AA%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/%E7%BC%96%E5%86%99JavaScript%E7%9A%8410%E4%B8%AA%E5%B0%8F%E6%8A%80%E5%B7%A7/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简化条件表达式"><a href="#简化条件表达式" class="headerlink" title="简化条件表达式"></a>简化条件表达式</h2><p>经常碰到这种情况，要判断某个变量是否为指定的某些值，用常规的逻辑表达式会很长。我的做法是把这些值放进数组里：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 太长的逻辑表达式</span></span><br><span class="line"><span class="keyword">if</span> (x === <span class="string">&#x27;abc&#x27;</span> || x === <span class="string">&#x27;def&#x27;</span> || x === <span class="string">&#x27;ghi&#x27;</span> || x ===<span class="string">&#x27;jkl&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">//其他逻辑</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 简写</span></span><br><span class="line"><span class="keyword">if</span> ([<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;ghi&#x27;</span>, <span class="string">&#x27;jkl&#x27;</span>].includes(x)) &#123;</span><br><span class="line">   <span class="comment">//其他逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="简化-if-…-else"><a href="#简化-if-…-else" class="headerlink" title="简化 if … else"></a>简化 if … else</h2><p>if…else太常用了，以至于很多人都忘了其实还有其他方式来判断条件。比如简单的变量赋值，完全没必要用这种冗长的语句，一行表达式就搞定了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新手的写法</span></span><br><span class="line"><span class="keyword">let</span> test= boolean;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    test = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    test = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 简写表达式</span></span><br><span class="line"><span class="keyword">let</span> test = (x &gt; <span class="number">10</span>) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 更直接的</span></span><br><span class="line"><span class="keyword">let</span> test = x &gt; <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(test);</span><br></pre></td></tr></table></figure><p>三元表达式可以做复杂的条件分支判断，不过牺牲了一些可读性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">300</span>,</span><br><span class="line"><span class="keyword">let</span> test2 = (x &gt; <span class="number">100</span>) ? <span class="string">&#x27;greater 100&#x27;</span> : (x &lt; <span class="number">50</span>) ? <span class="string">&#x27;less 50&#x27;</span> : <span class="string">&#x27;between 50 and 100&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(test2); <span class="comment">// &quot;greater than 100&quot;</span></span><br></pre></td></tr></table></figure><h2 id="判空并赋默认值"><a href="#判空并赋默认值" class="headerlink" title="判空并赋默认值"></a>判空并赋默认值</h2><p>Code Review 的时候我经常看到这样的代码，判断变量不是null，undefined，’’的时候赋值给第二个变量，否则给个默认值：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (first !== <span class="literal">null</span> || first !== <span class="literal">undefined</span> || first !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> second = first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 简写</span></span><br><span class="line"><span class="keyword">let</span> second = first || <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="简写循环遍历"><a href="#简写循环遍历" class="headerlink" title="简写循环遍历"></a>简写循环遍历</h2><p>for  循环是最基本的，但是有点繁琐。可以用 for…in、for…of 或者 forEach 代替：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Longhand</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; testData.length; i++)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Shorthand</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> testData) or  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> testData)</span><br></pre></td></tr></table></figure><p>数组遍历：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testData</span>(<span class="params">element, index, array</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;test[&#x27;</span> + index + <span class="string">&#x27;] = &#x27;</span> + element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="number">11</span>, <span class="number">24</span>, <span class="number">32</span>].forEach(testData);</span><br><span class="line"><span class="comment">// 打印输出: test[0] = 11, test[1] = 24, test[2] = 32</span></span><br></pre></td></tr></table></figure><h2 id="简化-switch"><a href="#简化-switch" class="headerlink" title="简化 switch"></a>简化 switch</h2><p>这个技巧也很常用，把switch  转换成对象的key-value形式，代码简洁多了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Longhand</span></span><br><span class="line"><span class="keyword">switch</span> (data) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    test1();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    test2();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    test();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// And so on...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Shorthand</span></span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">  <span class="number">1</span>: test1,</span><br><span class="line">  <span class="number">2</span>: test2,</span><br><span class="line">  <span class="number">3</span>: test</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">data[anything] &amp;&amp; data[anything]();</span><br></pre></td></tr></table></figure><h2 id="简化多行字符串拼接"><a href="#简化多行字符串拼接" class="headerlink" title="简化多行字符串拼接"></a>简化多行字符串拼接</h2><p>如果一个字符串表达式过长，我们可能会拆成多行拼接的方式。不过随着 ES6 的普及，更好的做法是用模板字符串：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//longhand</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="string">&#x27;abc abc abc abc abc abc\n\t&#x27;</span></span><br><span class="line">    + <span class="string">&#x27;test test,test test test test\n\t&#x27;</span></span><br><span class="line"><span class="comment">//shorthand</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="string">`abc abc abc abc abc abc</span></span><br><span class="line"><span class="string">         test test,test test test test`</span></span><br></pre></td></tr></table></figure><h2 id="善用箭头函数简化-return"><a href="#善用箭头函数简化-return" class="headerlink" title="善用箭头函数简化 return"></a>善用箭头函数简化 return</h2><p>ES6 的箭头函数真是个好东西，当函数简单到只需要返回一个表达式时，用箭头函数最合适不过了，return都不用写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Longhand:</span><br><span class="line"><span class="comment">//longhand</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArea</span>(<span class="params">diameter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.PI * diameter</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//shorthand</span></span><br><span class="line">getArea = <span class="function"><span class="params">diameter</span> =&gt;</span> (</span><br><span class="line">  <span class="built_in">Math</span>.PI * diameter;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="简化分支条件语句"><a href="#简化分支条件语句" class="headerlink" title="简化分支条件语句"></a>简化分支条件语句</h2><p>又是你，if…else if…else！跟 switch类似，也可以用key-value形式简化：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Longhand</span></span><br><span class="line"><span class="keyword">if</span> (type === <span class="string">&#x27;test1&#x27;</span>) &#123;</span><br><span class="line">  test1();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;test2&#x27;</span>) &#123;</span><br><span class="line">  test2();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;test3&#x27;</span>) &#123;</span><br><span class="line">  test3();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&#x27;test4&#x27;</span>) &#123;</span><br><span class="line">  test4();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Invalid value &#x27;</span> + type);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Shorthand</span></span><br><span class="line"><span class="keyword">var</span> types = &#123;</span><br><span class="line">  <span class="attr">test1</span>: test1,</span><br><span class="line">  <span class="attr">test2</span>: test2,</span><br><span class="line">  <span class="attr">test3</span>: test3,</span><br><span class="line">  <span class="attr">test4</span>: test4</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = types[type];</span><br><span class="line">(!func) &amp;&amp; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Invalid value &#x27;</span> + type); func();</span><br></pre></td></tr></table></figure><h2 id="重复字符串-N-次"><a href="#重复字符串-N-次" class="headerlink" title="重复字符串 N 次"></a>重复字符串 N 次</h2><p>有时候出于某种目的需要将字符串重复 N 次，最笨的方法就是用for循环拼接。其实更简单的方法是用repeat：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//longhand </span></span><br><span class="line"><span class="keyword">let</span> test = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123; </span><br><span class="line">  test += <span class="string">&#x27;test &#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(str); <span class="comment">// test test test test test </span></span><br><span class="line"><span class="comment">//shorthand </span></span><br><span class="line"><span class="string">&#x27;test &#x27;</span>.repeat(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><h2 id="指数运算"><a href="#指数运算" class="headerlink" title="指数运算"></a>指数运算</h2><p>能省则省，低碳环保。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//longhand</span></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>,<span class="number">3</span>); <span class="comment">// 8</span></span><br><span class="line"><span class="comment">//shorthand</span></span><br><span class="line"><span class="number">2</span>**<span class="number">3</span> <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><h2 id="数字分隔符"><a href="#数字分隔符" class="headerlink" title="数字分隔符"></a>数字分隔符</h2><p>这是比较新的语法，ES2021 提出来的，数字字面量可以用下划线分割，提高了大数字的可读性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧语法</span></span><br><span class="line"><span class="keyword">let</span> number = <span class="number">98234567</span></span><br><span class="line"><span class="comment">// 新语法</span></span><br><span class="line"><span class="keyword">let</span> number = <span class="number">98_234_567</span></span><br></pre></td></tr></table></figure><p>#javascript </p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;简化条件表达式&quot;&gt;&lt;a href=&quot;#简化条件表达式&quot; class=&quot;headerlink&quot; title=&quot;简化条件表达式&quot;&gt;&lt;/a&gt;简化条件表达式&lt;/h2&gt;&lt;p&gt;经常碰到这种情况，要判断某个变量是否为指定的某些值，用常规的逻辑表达式会很长。我的做法是把这些值放进数组里：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 太长的逻辑表达式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (x === &lt;span class=&quot;string&quot;&gt;&amp;#x27;abc&amp;#x27;&lt;/span&gt; || x === &lt;span class=&quot;string&quot;&gt;&amp;#x27;def&amp;#x27;&lt;/span&gt; || x === &lt;span class=&quot;string&quot;&gt;&amp;#x27;ghi&amp;#x27;&lt;/span&gt; || x ===&lt;span class=&quot;string&quot;&gt;&amp;#x27;jkl&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//其他逻辑&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 简写&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;string&quot;&gt;&amp;#x27;abc&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;def&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;ghi&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;jkl&amp;#x27;&lt;/span&gt;].includes(x)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//其他逻辑&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>高阶函数</title>
    <link href="https://tangxiaomi.top/2021/05/28/javascript/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://tangxiaomi.top/2021/05/28/javascript/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>JavaScript的函数可以指向某个变量，变量也可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为<code>高阶函数</code>。</p><h2 id="简单的高阶函数"><a href="#简单的高阶函数" class="headerlink" title="简单的高阶函数"></a>简单的高阶函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, f</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(x) + f(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当调用add(-5, 6, Math.abs)时，参数x，y和f分别接收-5，6和函数Math.abs，根据函数定义，可以推导计算过程为：</span></span><br><span class="line"><span class="comment">//x = -5;</span></span><br><span class="line"><span class="comment">//y = 6;</span></span><br><span class="line"><span class="comment">//f = Math.abs;</span></span><br><span class="line"><span class="comment">//f(x) + f(y) ==&gt; Math.abs(-5) + Math.abs(6) ==&gt; 11;</span></span><br><span class="line"><span class="comment">//return 11;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用代码验证一下：</span></span><br><span class="line">add(-<span class="number">5</span>, <span class="number">6</span>, <span class="built_in">Math</span>.abs); <span class="comment">// 11</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="常用的高阶函数"><a href="#常用的高阶函数" class="headerlink" title="常用的高阶函数"></a>常用的高阶函数</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pow</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line">arr.map(pow); <span class="comment">// [1, 4, 9, 16, 25, 36, 49, 64, 81]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//map()传入的参数是pow，即函数对象本身。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//不需要map()，写一个循环，也可以计算出结果：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">var</span> result = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i++) &#123;</span><br><span class="line">    result.push(f(arr[i]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//的确可以，但是，从上面的循环代码，我们无法一眼看明白“把f(x)作用在Array的每一个元素并把结果生成一个新的Array”。</span></span><br></pre></td></tr></table></figure><p>所以，map() 作为高阶函数，事实上它把运算规则抽象了，因此，我们不但可以计算简单的 f(x)=x2，还可以计算任意复杂的函数，比如，把 Array 的所有数字转为字符串：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line">arr.map(<span class="built_in">String</span>); <span class="comment">// [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;]</span></span><br><span class="line"><span class="comment">//只需要一行代码。</span></span><br></pre></td></tr></table></figure><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>再看 <code>reduce</code> 的用法。Array 的 <code>reduce()</code> 把一个函数作用在这个 Array 的 [x1, x2, x3…] 上，这个函数必须接收两个参数，reduce() 把<strong>结果继续和序列的下一个元素</strong>做累积计算，其效果就是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[x1, x2, x3, x4].reduce(f) = f(f(f(x1, x2), x3), x4)</span><br><span class="line"><span class="comment">//比方说对一个Array求和，就可以用reduce实现：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>filter 也是一个常用的操作，它用于把 Array 的某些元素过滤掉，然后返回剩下的元素。和 map() 类似，Array 的 filter() 也接收一个函数。和 map() 不同的是，filter() 把传入的函数依次作用于每个元素，然后根据返回值是 true 还是 false 决定保留还是丢弃该元素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如，在一个Array中，删掉偶数，只保留奇数，可以这么写：</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>];</span><br><span class="line"><span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line">r; <span class="comment">// [1, 5, 9, 15]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//把一个Array中的空字符串删掉，可以这么写：</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;  &#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s &amp;&amp; s.trim(); <span class="comment">// 注意：IE9以下的版本没有trim()方法</span></span><br><span class="line">&#125;);</span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure><p>回调函数：filter() 接收的回调函数，其实可以有多个参数。通常我们仅使用第一个参数，表示 Array 的某个元素。回调函数还可以接收另外两个参数，表示元素的位置和数组本身：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">element, index, self</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(element); <span class="comment">// 依次打印&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">    <span class="built_in">console</span>.log(index); <span class="comment">// 依次打印0, 1, 2</span></span><br><span class="line">    <span class="built_in">console</span>.log(self); <span class="comment">// self就是变量arr</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用filter，可以巧妙地去除Array的重复元素：</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> r,</span><br><span class="line">    arr = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>];</span><br><span class="line">r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">element, index, self</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.indexOf(element) === index;</span><br><span class="line">&#125;);</span><br><span class="line">alert(r.toString());</span><br><span class="line"><span class="comment">//去除重复元素依靠的是indexOf总是返回第一个元素的位置，后续的重复元素位置与indexOf返回的位置不相等，因此被filter滤掉了。</span></span><br></pre></td></tr></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>因为 Array 的 <strong>sort()方法默认把所有元素先转换为String再排序，结果’10’排在了’2’的前面</strong>，因为字符’1’比字符’2’的ASCII码小。如果不知道 sort() 方法的默认排序规则，直接对数字排序，绝对栽进坑里！</p><p>幸运的是，sort() 方法也是一个高阶函数，它还可以接收一个比较函数来实现自定义的排序。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//要按数字大小排序，我们可以这么写：</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// [1, 2, 10, 20]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果要倒序排序，我们可以把大的数放前面：</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// [20, 10, 2, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//默认情况下，对字符串排序，是按照ASCII的大小比较的，现在，排序应该忽略大小写，按照字母序排序。</span></span><br><span class="line"><span class="comment">//要实现这个算法，不必对现有代码大加改动，只要我们能定义出忽略大小写的比较算法就可以：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">s1, s2</span>) </span>&#123;</span><br><span class="line">    x1 = s1.toUpperCase();</span><br><span class="line">    x2 = s2.toUpperCase();</span><br><span class="line">    <span class="keyword">if</span> (x1 &lt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// [&#x27;apple&#x27;, &#x27;Google&#x27;, &#x27;Microsoft&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//忽略大小写来比较两个字符串，实际上就是先把字符串都变成大写（或者都变成小写），再比较。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//sort()方法会直接对Array进行修改，它返回的结果仍是当前Array：</span></span><br><span class="line"><span class="keyword">var</span> a1 = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> a2 = a1.sort();</span><br><span class="line">a1; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a2; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a1 === a2; <span class="comment">// true, a1和a2是同一对象 </span></span><br></pre></td></tr></table></figure><p>#javascript</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;JavaScript的函数可以指向某个变量，变量也可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为&lt;code&gt;高阶函数&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;简单的高阶函数&quot;&gt;&lt;a href=&quot;#简单的高阶函数&quot; class=&quot;headerlink&quot; title=&quot;简单的高阶函数&quot;&gt;&lt;/a&gt;简单的高阶函数&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;add&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;x, y, f&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; f(x) + f(y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//当调用add(-5, 6, Math.abs)时，参数x，y和f分别接收-5，6和函数Math.abs，根据函数定义，可以推导计算过程为：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//x = -5;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//y = 6;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//f = Math.abs;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//f(x) + f(y) ==&amp;gt; Math.abs(-5) + Math.abs(6) ==&amp;gt; 11;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//return 11;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//用代码验证一下：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;add(-&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;Math&lt;/span&gt;.abs); &lt;span class=&quot;comment&quot;&gt;// 11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/categories/javascript/"/>
    
    
    <category term="javascript" scheme="https://tangxiaomi.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Mac设置环境变量path的几种方法</title>
    <link href="https://tangxiaomi.top/2021/05/28/other/Mac%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8Fpath%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <id>https://tangxiaomi.top/2021/05/28/other/Mac%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8Fpath%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p>Mac系统的环境变量，加载顺序为：</p><ol><li>系统<ul><li>/etc/profile</li><li>/etc/paths</li></ul></li></ol><p><code>/etc/profile</code> 和 <code>/etc/paths</code> 是系统级别的，系统启动就会加载</p><ol start="2"><li>用户<ul><li>~/.bash_profile </li><li>~/.bash_login </li><li>~/.profile </li><li>~/.bashrc</li></ul></li></ol><p>按照从前往后的顺序读取，如果 <code>~/.bash_profile</code> 文件存在，则后面的几个文件就会被忽略不读了，如果 <code>~/.bash_profile</code> 文件不存在，才会以此类推读取后面的文件。<code>~/.bashrc</code> 没有上述规则，它是 <code>bash shell</code> 打开的时候载入的</p><p>如果没特殊说明,设置PATH的语法都为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:&lt;PATH 1&gt;:&lt;PATH 2&gt;:&lt;PATH 3&gt;:------:&lt;PATH N&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a>全局设置</h2><p>下面的几个文件设置是全局的，修改时需要root权限</p><ol><li><p><code>/etc/paths</code> （全局建议修改这个文件 ）<br>编辑 <code>paths</code>，将环境变量添加到 <code>paths</code> 文件中 ，一行一个路径<br>Hint：输入环境变量时，不用一个一个地输入，只要拖动文件夹到 Terminal 里就可以了。</p></li><li><p><code>/etc/profile</code> （建议不修改这个文件 ）<br>全局（公有）配置，不管是哪个用户，登录时都会读取该文件。</p></li><li><p><code>/etc/bashrc</code> （一般在这个文件中添加系统级环境变量）<br>全局（公有）配置，<code>bash shell</code> 执行时，不管是何种方式，都会读取此文件。</p></li><li></li></ol><ul><li>创建一个文件：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo touch /etc/paths.d/mysql</span><br></pre></td></tr></table></figure></li><li>用 vim 打开这个文件（如果是以 <code>open -t</code> 的方式打开，则不允许编辑）：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/paths.d/mysql</span><br></pre></td></tr></table></figure></li><li>编辑该文件，键入路径并保存（关闭该 <code>Terminal</code> 窗口并重新打开一个，就能使用 mysql 命令了）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin</span><br></pre></td></tr></table></figure>据说，这样可以自己生成新的文件，不用把变量全都放到 <code>paths</code> 一个文件里，方便管理。</li></ul><h2 id="单个用户设置"><a href="#单个用户设置" class="headerlink" title="单个用户设置"></a>单个用户设置</h2><ol><li><code>~/.bash_profile</code> （任意一个文件中添加用户级环境变量）<br>（注：Linux 里面是 <code>.bashrc</code> 而 Mac 是 <code>.bash_profile</code>）<br>若bash shell是以login方式执行时，才会读取此文件。该文件仅仅执行一次!默认情况下,他设置一些环境变量<br>设置命令别名<code>alias ll=’ls -la’</code></li></ol><p>设置环境变量：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/local/bin:/opt/local/sbin:$PATH</span><br></pre></td></tr></table></figure><ol start="2"><li><code>~/.bashrc</code> 同上</li></ol><p>如果想立刻生效，则可执行下面的语句：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source 相应的文件</span><br></pre></td></tr></table></figure><p>一般环境变量更改后，重启后生效。</p><p>#other</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Mac系统的环境变量，加载顺序为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;系统&lt;ul&gt;
&lt;li&gt;/etc/profile&lt;/li&gt;
&lt;li&gt;/etc/paths&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;/etc/profile&lt;/code&gt; 和 &lt;code&gt;/etc/paths&lt;/code&gt; 是系统级别的，系统启动就会加载&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;用户&lt;ul&gt;
&lt;li&gt;~/.bash_profile &lt;/li&gt;
&lt;li&gt;~/.bash_login &lt;/li&gt;
&lt;li&gt;~/.profile &lt;/li&gt;
&lt;li&gt;~/.bashrc&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;按照从前往后的顺序读取，如果 &lt;code&gt;~/.bash_profile&lt;/code&gt; 文件存在，则后面的几个文件就会被忽略不读了，如果 &lt;code&gt;~/.bash_profile&lt;/code&gt; 文件不存在，才会以此类推读取后面的文件。&lt;code&gt;~/.bashrc&lt;/code&gt; 没有上述规则，它是 &lt;code&gt;bash shell&lt;/code&gt; 打开的时候载入的&lt;/p&gt;
&lt;p&gt;如果没特殊说明,设置PATH的语法都为：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;export PATH=$PATH:&amp;lt;PATH 1&amp;gt;:&amp;lt;PATH 2&amp;gt;:&amp;lt;PATH 3&amp;gt;:------:&amp;lt;PATH N&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="other" scheme="https://tangxiaomi.top/categories/other/"/>
    
    
    <category term="other" scheme="https://tangxiaomi.top/tags/other/"/>
    
  </entry>
  
  <entry>
    <title>ios提醒事项同步日历快捷指令脚本</title>
    <link href="https://tangxiaomi.top/2021/05/28/other/ios%E6%8F%90%E9%86%92%E4%BA%8B%E9%A1%B9%E5%90%8C%E6%AD%A5%E6%97%A5%E5%8E%86%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E8%84%9A%E6%9C%AC/"/>
    <id>https://tangxiaomi.top/2021/05/28/other/ios%E6%8F%90%E9%86%92%E4%BA%8B%E9%A1%B9%E5%90%8C%E6%AD%A5%E6%97%A5%E5%8E%86%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E8%84%9A%E6%9C%AC/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<ul><li>AppStore 安装运行脚本的软件 <code>scriptable</code></li></ul><p><a href="https://docs.scriptable.app/">scriptable https://docs.scriptable.app</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DUR_MONTH = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> startDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">startDate.setMonth(startDate.getMonth() - DUR_MONTH)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`日历的开始时间 <span class="subst">$&#123;startDate.toLocaleDateString()&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> endDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">endDate.setMonth(endDate.getMonth() + DUR_MONTH)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`日历的结束时间 <span class="subst">$&#123;endDate.toLocaleDateString()&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reminders = <span class="keyword">await</span> Reminder.allDueBetween(startDate, endDate)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`获取 <span class="subst">$&#123;reminders.length&#125;</span> 条提醒事项`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> calendar = <span class="keyword">await</span> Calendar.forEvents()</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取日历名和对应的日历</span></span><br><span class="line"><span class="keyword">var</span> m_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (cal <span class="keyword">of</span> calendar) &#123;</span><br><span class="line">    m_dict[cal.title] = cal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> events = <span class="keyword">await</span> CalendarEvent.between(startDate, endDate, calendar)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`获取 <span class="subst">$&#123;events.length&#125;</span> 条日历`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> reminder <span class="keyword">of</span> reminders) &#123;</span><br><span class="line">    <span class="comment">//reminder的标识符</span></span><br><span class="line">    <span class="keyword">const</span> id = reminder.identifier.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> targetNote = <span class="string">`🍧 <span class="subst">$&#123;id&#125;</span> 🍰`</span></span><br><span class="line">    <span class="comment">// 添加标识符存进备注 用来防止重复添加</span></span><br><span class="line">    <span class="keyword">const</span> [targetEvent] = events.filter(</span><br><span class="line">        <span class="function">(<span class="params">e</span>) =&gt;</span> e.notes != <span class="literal">null</span> &amp;&amp; e.notes.indexOf(targetNote) != -<span class="number">1</span></span><br><span class="line">    ) <span class="comment">//过滤重复的reminder</span></span><br><span class="line">    <span class="keyword">if</span> (!m_dict[reminder.calendar.title]) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&#x27;找不到日历&#x27;</span> + reminder.calendar.title)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (targetEvent) &#123;</span><br><span class="line">        <span class="comment">//console.log(`找到已经创建的事项 $&#123;reminder.title&#125;`)</span></span><br><span class="line">        updateEvent(targetEvent, reminder)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">`创建事项 <span class="subst">$&#123;reminder.title&#125;</span> 到 <span class="subst">$&#123;reminder.calendar.title&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">const</span> newEvent = <span class="keyword">new</span> CalendarEvent()</span><br><span class="line">        <span class="keyword">const</span> notes = reminder.notes ? reminder.notes : <span class="string">&#x27;&#x27;</span></span><br><span class="line">        newEvent.notes = targetNote + <span class="string">&#x27;\n\n&#x27;</span> + notes <span class="comment">//要加入备注</span></span><br><span class="line">        updateEvent(newEvent, reminder)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Script.complete()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateEvent</span>(<span class="params">event, reminder</span>) </span>&#123;</span><br><span class="line">    event.title = <span class="string">`<span class="subst">$&#123;reminder.title&#125;</span>`</span></span><br><span class="line">    cal_name = reminder.calendar.title</span><br><span class="line">    cal = m_dict[cal_name]</span><br><span class="line">    event.calendar = cal</span><br><span class="line">    <span class="comment">//已完成事项</span></span><br><span class="line">    <span class="keyword">if</span> (reminder.isCompleted) &#123;</span><br><span class="line">        event.title = <span class="string">`✅ <span class="subst">$&#123;reminder.title&#125;</span>`</span></span><br><span class="line">        event.isAllDay = <span class="literal">false</span></span><br><span class="line">        event.startDate = reminder.completionDate</span><br><span class="line">        <span class="keyword">var</span> ending = <span class="keyword">new</span> <span class="built_in">Date</span>(reminder.completionDate)</span><br><span class="line">        ending.setHours(ending.getHours() + <span class="number">1</span>)</span><br><span class="line">        event.endDate = ending</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> period =</span><br><span class="line">            (reminder.dueDate - reminder.completionDate) / <span class="number">1000</span> / <span class="number">3600</span> / <span class="number">24</span></span><br><span class="line">        period = period.toFixed(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (period &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            period = -period</span><br><span class="line">            event.location = <span class="string">&#x27; 延期&#x27;</span> + period + <span class="string">&#x27;天完成&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (period == <span class="number">0</span>) &#123;</span><br><span class="line">            event.location = <span class="string">&#x27; 准时完成&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            event.location = <span class="string">&#x27; 提前&#x27;</span> + period + <span class="string">&#x27;天完成&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//未完成事项</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> nowtime = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">        <span class="keyword">var</span> period = (reminder.dueDate - nowtime) / <span class="number">1000</span> / <span class="number">3600</span> / <span class="number">24</span></span><br><span class="line">        period = period.toFixed(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (period &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//待办顺延</span></span><br><span class="line"></span><br><span class="line">            event.location = <span class="string">&#x27; 延期&#x27;</span> + -period + <span class="string">&#x27;天&#x27;</span></span><br><span class="line">            <span class="comment">//如果不是在同一天,设置为全天事项</span></span><br><span class="line">            <span class="keyword">if</span> (reminder.dueDate.getDate() != nowtime.getDate()) &#123;</span><br><span class="line">                event.title = <span class="string">`❌ <span class="subst">$&#123;reminder.title&#125;</span>`</span></span><br><span class="line">                event.startDate = nowtime</span><br><span class="line">                event.endDate = nowtime</span><br><span class="line">                event.isAllDay = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//在同一天的保持原来的时间</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                event.title = <span class="string">`⭕️ <span class="subst">$&#123;reminder.title&#125;</span>`</span></span><br><span class="line">                event.isAllDay = <span class="literal">false</span></span><br><span class="line">                event.startDate = reminder.dueDate</span><br><span class="line">                <span class="keyword">var</span> ending = <span class="keyword">new</span> <span class="built_in">Date</span>(reminder.dueDate)</span><br><span class="line">                ending.setHours(ending.getHours() + <span class="number">1</span>)</span><br><span class="line">                event.endDate = ending</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`【<span class="subst">$&#123;reminder.title&#125;</span>】待办顺延<span class="subst">$&#123;-period&#125;</span>天`</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            event.title = <span class="string">`⭕️ <span class="subst">$&#123;reminder.title&#125;</span>`</span></span><br><span class="line">            event.isAllDay = <span class="literal">false</span></span><br><span class="line">            event.location = <span class="string">&#x27;还剩&#x27;</span> + period + <span class="string">&#x27;天&#x27;</span></span><br><span class="line">            event.startDate = reminder.dueDate</span><br><span class="line">            <span class="keyword">var</span> ending = <span class="keyword">new</span> <span class="built_in">Date</span>(reminder.dueDate)</span><br><span class="line">            ending.setHours(ending.getHours() + <span class="number">1</span>)</span><br><span class="line">            event.endDate = ending</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    event.save()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>提醒事项数据格式</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;identifier&quot;</span>: <span class="string">&quot;29803A1E-6C2F-454D-B366-2C67EB1F24BD&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Recite word&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;isCompleted&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;isOverdue&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;priority&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;dueDate&quot;</span>: <span class="string">&quot;2021-03-11T23:20:00.000Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dueDateIncludesTime&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;completionDate&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;creationDate&quot;</span>: <span class="string">&quot;2021-03-12T03:28:00.621Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;calendar&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;identifier&quot;</span>: <span class="string">&quot;282088E0-DC16-4827-BA21-9B9FD5F0A16F&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Learn&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;isSubscribed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;allowsContentModifications&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;color&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;hex&quot;</span>: <span class="string">&quot;FF2968&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;red&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;green&quot;</span>: <span class="number">0.1607843041419983</span>,</span><br><span class="line">      <span class="attr">&quot;blue&quot;</span>: <span class="number">0.40784314274787903</span>,</span><br><span class="line">      <span class="attr">&quot;alpha&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://tangxiaomi.top/2021/03/12/other/reminders-sync-calendar/">ios 提醒事项同步日历快捷指令脚本</a></p><p>#other</p>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;AppStore 安装运行脚本的软件 &lt;code&gt;scriptable&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.scriptable.app/&quot;&gt;scriptable https://docs.scriptable.</summary>
      
    
    
    
    <category term="other" scheme="https://tangxiaomi.top/categories/other/"/>
    
    
    <category term="other" scheme="https://tangxiaomi.top/tags/other/"/>
    
  </entry>
  
  <entry>
    <title>你是哪种程序员？</title>
    <link href="https://tangxiaomi.top/2021/05/28/other/%E4%BD%A0%E6%98%AF%E5%93%AA%E7%A7%8D%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%9F/"/>
    <id>https://tangxiaomi.top/2021/05/28/other/%E4%BD%A0%E6%98%AF%E5%93%AA%E7%A7%8D%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%9F/</id>
    <published>2021-05-28T01:23:48.106Z</published>
    <updated>2021-05-28T01:23:48.106Z</updated>
    
    <content type="html"><![CDATA[<p><strong>1.对待需求的态度</strong></p><p><strong>优秀程序员</strong> ：在有需求与任务时，会不断的询问需求与任务，并且多次确认想要的结果，再动手写代码。</p><p><strong>一般程序员</strong> ：接到任务就闷头写代码，反<br>正做错了也是你们要求的，不是我的锅。</p><p><img src="/images/__640.jpeg"></p><p><strong>2.编码习惯</strong></p><p><strong>优秀程序员</strong> ：他的代码读起来是赏心悦目的，若遇到难理解的实现点时，他也会写下清晰的注释来帮助后来人理解。</p><p><strong>一般程序员</strong> ：我有我的代码风格，我看得懂就行了。几个月后我也看不懂了，那就重写一遍吧。</p><p><img src="/images/___640.jpeg"></p><p><strong>3. 善于学习</strong></p><p><strong>优秀程序员</strong> ：遇到没接触过的技术时，他会主动搜索资料去学习钻研，并以此为乐趣。</p><p><strong>一般程序员</strong> ：疯狂地找插件，类库和框架，常常做代码搬运工，安慰自己不要造轮子。</p><p><img src="/images/____640.jpeg"></p><p><strong>4. 对工作精益求精</strong></p><p><strong>优秀程序员</strong> ：会抽时间review自己的代码，并思考如何提高性能。</p><p><strong>一般程序员</strong> ：只喜欢开发新项目，不喜欢维护旧项目，万一搞崩了呢？</p><p><img src="/images/_____640.jpeg"></p><p><strong>5. 有钻研精神</strong></p><p><strong>优秀程序员</strong> ：遇到问题，会考虑独立寻求解决办法，提升自己处理问题的能力。</p><p><strong>一般程序员</strong> ：喜欢把问题交给别人，把代码发给被人，让别人帮他找问题。</p><p><img src="/images/______640.jpeg"></p><p><strong>6. 良好的情绪管理</strong></p><p><strong>优秀程序员</strong> ：理解需求是会不断变化的，不会把消极情绪表达出来，能控制好情绪，能跟产品经理和谐愉快沟通。</p><p><strong>一般程序员</strong> ：因为需求反复修改就索性说这个代码实现不了。</p><p><img src="/images/_______640.jpeg"></p><p><strong>7. 态度很谦虚</strong></p><p><strong>优秀程序员</strong> ：对新的技术敏感度，保持学习的热情，而且为人很谦虚，不觉得自己有多牛。</p><p><strong>一般程序员</strong> ：生怕别人不觉得他是大牛，到处瞎逼逼。</p><p><img src="/images/________640.jpeg"></p><p>#other</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;1.对待需求的态度&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优秀程序员&lt;/strong&gt; ：在有需求与任务时，会不断的询问需求与任务，并且多次确认想要的结果，再动手写代码。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一般程序员&lt;/strong&gt; ：接到任务就闷头</summary>
      
    
    
    
    <category term="other" scheme="https://tangxiaomi.top/categories/other/"/>
    
    
    <category term="other" scheme="https://tangxiaomi.top/tags/other/"/>
    
  </entry>
  
</feed>

{"sort":46,"title":" ios 提醒事项同步日历快捷指令脚本","slug":"other/6238c21f55","date":"2021-05-03T00:00:00.000Z","updated":"2021-06-17T11:25:09.047Z","comments":true,"path":"api/articles/other/6238c21f55.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<ul>\n<li>AppStore 安装运行脚本的软件 <code>scriptable</code></li>\n</ul>\n<p><a href=\"https://docs.scriptable.app/\">scriptable https://docs.scriptable.app</a></p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> DUR_MONTH = <span class=\"hljs-number\">1</span>\n\n<span class=\"hljs-keyword\">const</span> startDate = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>()\nstartDate.setMonth(startDate.getMonth() - DUR_MONTH)\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`日历的开始时间 <span class=\"hljs-subst\">$&#123;startDate.toLocaleDateString()&#125;</span>`</span>)\n\n<span class=\"hljs-keyword\">const</span> endDate = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>()\nendDate.setMonth(endDate.getMonth() + DUR_MONTH)\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`日历的结束时间 <span class=\"hljs-subst\">$&#123;endDate.toLocaleDateString()&#125;</span>`</span>)\n\n<span class=\"hljs-keyword\">const</span> reminders = <span class=\"hljs-keyword\">await</span> Reminder.allDueBetween(startDate, endDate)\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`获取 <span class=\"hljs-subst\">$&#123;reminders.length&#125;</span> 条提醒事项`</span>)\n\n<span class=\"hljs-keyword\">var</span> calendar = <span class=\"hljs-keyword\">await</span> Calendar.forEvents()\n\n<span class=\"hljs-comment\">//获取日历名和对应的日历</span>\n<span class=\"hljs-keyword\">var</span> m_dict = &#123;&#125;\n<span class=\"hljs-keyword\">for</span> (cal <span class=\"hljs-keyword\">of</span> calendar) &#123;\n    m_dict[cal.title] = cal\n&#125;\n\n<span class=\"hljs-keyword\">const</span> events = <span class=\"hljs-keyword\">await</span> CalendarEvent.between(startDate, endDate, calendar)\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`获取 <span class=\"hljs-subst\">$&#123;events.length&#125;</span> 条日历`</span>)\n\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">const</span> reminder <span class=\"hljs-keyword\">of</span> reminders) &#123;\n    <span class=\"hljs-comment\">//reminder的标识符</span>\n    <span class=\"hljs-keyword\">const</span> id = reminder.identifier.split(<span class=\"hljs-string\">&#x27;-&#x27;</span>)[<span class=\"hljs-number\">0</span>]\n    <span class=\"hljs-keyword\">const</span> targetNote = <span class=\"hljs-string\">`🍧 <span class=\"hljs-subst\">$&#123;id&#125;</span> 🍰`</span>\n    <span class=\"hljs-comment\">// 添加标识符存进备注 用来防止重复添加</span>\n    <span class=\"hljs-keyword\">const</span> [targetEvent] = events.filter(\n        <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> e.notes != <span class=\"hljs-literal\">null</span> &amp;&amp; e.notes.indexOf(targetNote) != -<span class=\"hljs-number\">1</span>\n    ) <span class=\"hljs-comment\">//过滤重复的reminder</span>\n    <span class=\"hljs-keyword\">if</span> (!m_dict[reminder.calendar.title]) &#123;\n        <span class=\"hljs-built_in\">console</span>.warn(<span class=\"hljs-string\">&#x27;找不到日历&#x27;</span> + reminder.calendar.title)\n        <span class=\"hljs-keyword\">continue</span>\n    &#125;\n    <span class=\"hljs-keyword\">if</span> (targetEvent) &#123;\n        <span class=\"hljs-comment\">//console.log(`找到已经创建的事项 $&#123;reminder.title&#125;`)</span>\n        updateEvent(targetEvent, reminder)\n    &#125; <span class=\"hljs-keyword\">else</span> &#123;\n        <span class=\"hljs-built_in\">console</span>.warn(<span class=\"hljs-string\">`创建事项 <span class=\"hljs-subst\">$&#123;reminder.title&#125;</span> 到 <span class=\"hljs-subst\">$&#123;reminder.calendar.title&#125;</span>`</span>)\n        <span class=\"hljs-keyword\">const</span> newEvent = <span class=\"hljs-keyword\">new</span> CalendarEvent()\n        <span class=\"hljs-keyword\">const</span> notes = reminder.notes ? reminder.notes : <span class=\"hljs-string\">&#x27;&#x27;</span>\n        newEvent.notes = targetNote + <span class=\"hljs-string\">&#x27;\\n\\n&#x27;</span> + notes <span class=\"hljs-comment\">//要加入备注</span>\n        updateEvent(newEvent, reminder)\n    &#125;\n&#125;\n\nScript.complete()\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">updateEvent</span>(<span class=\"hljs-params\">event, reminder</span>) </span>&#123;\n    event.title = <span class=\"hljs-string\">`<span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>`</span>\n    cal_name = reminder.calendar.title\n    cal = m_dict[cal_name]\n    event.calendar = cal\n    <span class=\"hljs-comment\">//已完成事项</span>\n    <span class=\"hljs-keyword\">if</span> (reminder.isCompleted) &#123;\n        event.title = <span class=\"hljs-string\">`✅ <span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>`</span>\n        event.isAllDay = <span class=\"hljs-literal\">false</span>\n        event.startDate = reminder.completionDate\n        <span class=\"hljs-keyword\">var</span> ending = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>(reminder.completionDate)\n        ending.setHours(ending.getHours() + <span class=\"hljs-number\">1</span>)\n        event.endDate = ending\n\n        <span class=\"hljs-keyword\">var</span> period =\n            (reminder.dueDate - reminder.completionDate) / <span class=\"hljs-number\">1000</span> / <span class=\"hljs-number\">3600</span> / <span class=\"hljs-number\">24</span>\n        period = period.toFixed(<span class=\"hljs-number\">1</span>)\n        <span class=\"hljs-keyword\">if</span> (period &lt; <span class=\"hljs-number\">0</span>) &#123;\n            period = -period\n            event.location = <span class=\"hljs-string\">&#x27; 延期&#x27;</span> + period + <span class=\"hljs-string\">&#x27;天完成&#x27;</span>\n        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (period == <span class=\"hljs-number\">0</span>) &#123;\n            event.location = <span class=\"hljs-string\">&#x27; 准时完成&#x27;</span>\n        &#125; <span class=\"hljs-keyword\">else</span> &#123;\n            event.location = <span class=\"hljs-string\">&#x27; 提前&#x27;</span> + period + <span class=\"hljs-string\">&#x27;天完成&#x27;</span>\n        &#125;\n    &#125;\n    <span class=\"hljs-comment\">//未完成事项</span>\n    <span class=\"hljs-keyword\">else</span> &#123;\n        <span class=\"hljs-keyword\">const</span> nowtime = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>()\n        <span class=\"hljs-keyword\">var</span> period = (reminder.dueDate - nowtime) / <span class=\"hljs-number\">1000</span> / <span class=\"hljs-number\">3600</span> / <span class=\"hljs-number\">24</span>\n        period = period.toFixed(<span class=\"hljs-number\">1</span>)\n        <span class=\"hljs-keyword\">if</span> (period &lt; <span class=\"hljs-number\">0</span>) &#123;\n            <span class=\"hljs-comment\">//待办顺延</span>\n\n            event.location = <span class=\"hljs-string\">&#x27; 延期&#x27;</span> + -period + <span class=\"hljs-string\">&#x27;天&#x27;</span>\n            <span class=\"hljs-comment\">//如果不是在同一天,设置为全天事项</span>\n            <span class=\"hljs-keyword\">if</span> (reminder.dueDate.getDate() != nowtime.getDate()) &#123;\n                event.title = <span class=\"hljs-string\">`❌ <span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>`</span>\n                event.startDate = nowtime\n                event.endDate = nowtime\n                event.isAllDay = <span class=\"hljs-literal\">true</span>\n            &#125;\n            <span class=\"hljs-comment\">//在同一天的保持原来的时间</span>\n            <span class=\"hljs-keyword\">else</span> &#123;\n                event.title = <span class=\"hljs-string\">`⭕️ <span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>`</span>\n                event.isAllDay = <span class=\"hljs-literal\">false</span>\n                event.startDate = reminder.dueDate\n                <span class=\"hljs-keyword\">var</span> ending = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>(reminder.dueDate)\n                ending.setHours(ending.getHours() + <span class=\"hljs-number\">1</span>)\n                event.endDate = ending\n            &#125;\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`【<span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>】待办顺延<span class=\"hljs-subst\">$&#123;-period&#125;</span>天`</span>)\n        &#125; <span class=\"hljs-keyword\">else</span> &#123;\n            event.title = <span class=\"hljs-string\">`⭕️ <span class=\"hljs-subst\">$&#123;reminder.title&#125;</span>`</span>\n            event.isAllDay = <span class=\"hljs-literal\">false</span>\n            event.location = <span class=\"hljs-string\">&#x27;还剩&#x27;</span> + period + <span class=\"hljs-string\">&#x27;天&#x27;</span>\n            event.startDate = reminder.dueDate\n            <span class=\"hljs-keyword\">var</span> ending = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>(reminder.dueDate)\n            ending.setHours(ending.getHours() + <span class=\"hljs-number\">1</span>)\n            event.endDate = ending\n        &#125;\n    &#125;\n    event.save()\n&#125;\n</code></pre>\n\n<ul>\n<li>提醒事项数据格式</li>\n</ul>\n<pre><code class=\"hljs json\">&#123;\n  <span class=\"hljs-attr\">&quot;identifier&quot;</span>: <span class=\"hljs-string\">&quot;29803A1E-6C2F-454D-B366-2C67EB1F24BD&quot;</span>,\n  <span class=\"hljs-attr\">&quot;title&quot;</span>: <span class=\"hljs-string\">&quot;Recite word&quot;</span>,\n  <span class=\"hljs-attr\">&quot;isCompleted&quot;</span>: <span class=\"hljs-literal\">false</span>,\n  <span class=\"hljs-attr\">&quot;isOverdue&quot;</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">&quot;priority&quot;</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">&quot;dueDate&quot;</span>: <span class=\"hljs-string\">&quot;2021-03-11T23:20:00.000Z&quot;</span>,\n  <span class=\"hljs-attr\">&quot;dueDateIncludesTime&quot;</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">&quot;completionDate&quot;</span>: <span class=\"hljs-literal\">null</span>,\n  <span class=\"hljs-attr\">&quot;creationDate&quot;</span>: <span class=\"hljs-string\">&quot;2021-03-12T03:28:00.621Z&quot;</span>,\n  <span class=\"hljs-attr\">&quot;calendar&quot;</span>: &#123;\n    <span class=\"hljs-attr\">&quot;identifier&quot;</span>: <span class=\"hljs-string\">&quot;282088E0-DC16-4827-BA21-9B9FD5F0A16F&quot;</span>,\n    <span class=\"hljs-attr\">&quot;title&quot;</span>: <span class=\"hljs-string\">&quot;Learn&quot;</span>,\n    <span class=\"hljs-attr\">&quot;isSubscribed&quot;</span>: <span class=\"hljs-literal\">false</span>,\n    <span class=\"hljs-attr\">&quot;allowsContentModifications&quot;</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-attr\">&quot;color&quot;</span>: &#123;\n      <span class=\"hljs-attr\">&quot;hex&quot;</span>: <span class=\"hljs-string\">&quot;FF2968&quot;</span>,\n      <span class=\"hljs-attr\">&quot;red&quot;</span>: <span class=\"hljs-number\">1</span>,\n      <span class=\"hljs-attr\">&quot;green&quot;</span>: <span class=\"hljs-number\">0.1607843041419983</span>,\n      <span class=\"hljs-attr\">&quot;blue&quot;</span>: <span class=\"hljs-number\">0.40784314274787903</span>,\n      <span class=\"hljs-attr\">&quot;alpha&quot;</span>: <span class=\"hljs-number\">1</span>\n    &#125;\n  &#125;\n&#125;\n</code></pre>\n\n<p><a href=\"https://tangxiaomi.top/2021/03/12/other/reminders-sync-calendar/\">ios 提醒事项同步日历快捷指令脚本</a></p>\n","prev":{"title":" 枚举","slug":"typescript/1c6b93719a"},"next":{"title":" 类","slug":"typescript/98dfa9bae0"},"categories":[{"name":"other","slug":"other","count":4,"path":"api/categories/other.json"}],"tags":[{"name":"other","slug":"other","count":4,"path":"api/tags/other.json"}]}